(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{147:function(e,t,a){e.exports=a.p+"static/media/icon.f46e375d.png"},15:function(e,t,a){"use strict";function n(e){try{return localStorage.getItem(e)||null}catch(t){return console.warn("Could not read from localStorage."),null}}function s(e,t){try{localStorage.setItem(e,t)}catch(a){console.warn("Could not write to localStorage.")}}function r(e){try{localStorage.removeItem(e)}catch(t){console.warn("Could not delete from localStorage.")}}a.d(t,"a",function(){return n}),a.d(t,"c",function(){return s}),a.d(t,"b",function(){return r})},150:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return L});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(12),l=a(0),c=a.n(l),u=a(18),m=a(172),d=a(69),p=a.n(d),h=a(169),f=a(28),g=a(21),b=a(67),E=a(23),v=a(34),y=a(14),S=a(8),D=a(96),w=a(171),O=a(267),j=a(35),N=a(22),k=a(170),C=a(89),P=a(65),F=a(5),_=a(90),T=a(87),I=a(151),A=a(91),z=a(66),x={formatDate:function(e){return e.toISOString().split("T")[0]},parseDate:function(e){return new Date(e)},placeholder:"YYYY-MM-DD"},B={usePortal:!0},U=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).archiveForm=function(e){s.archiveFormPromise=Object(F.a)(Object(P.a)(s.props.formId,s.props.userDetails.username,s.props.userDetails.password)),s.archiveFormPromise.promise.then(function(e){s.setState({formArchivedOrDelete:!0})}).catch(function(e){return console.log(e)})},s.deleteForm=function(e){s.deleteFormPromise=Object(F.a)(Object(P.c)(s.props.formId,s.props.userDetails.username,s.props.userDetails.password)),s.deleteFormPromise.promise.then(function(e){s.setState({formArchivedOrDelete:!0})}).catch(function(e){return console.log(e)})},s.download=function(t,a){s.setState({downloadName:""});var n=new e(s.props.userDetails.username+":"+s.props.userDetails.password).toString("base64");return fetch("/omk/odk/submissions/".concat(t),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(n)}}).then(F.b).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e);s.setState({activeBlob:n}),s.setState({downloadName:a||t.split("?")[0]})})},s.downloadCsv=function(e){s.download("".concat(s.props.formId,".csv")),s.toggleDialog()},s.downloadJson=function(e){s.download("".concat(s.props.formId,".json")),s.toggleDialog()},s.downloadAttachments=function(e){s.download("".concat(s.props.formId,".zip")),s.toggleDialog()},s.downloadFilteredCsv=function(e){s.download("".concat(s.props.formId,".csv?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFilteredJson=function(e){s.download("".concat(s.props.formId,".json?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFilteredAttachments=function(e){s.download("".concat(s.props.formId,".zip?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadAllOsm=function(e){s.download("".concat(s.props.formId,".osm")),s.toggleDialog()},s.downloadFilteredOsm=function(e){s.download("".concat(s.props.formId,".osm?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadGeojson=function(e){s.download("".concat(s.props.formId,".geojson")),s.toggleDialog()},s.downloadFilteredGeojson=function(e){s.download("".concat(s.props.formId,".geojson?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFeaturesCsv=function(e){s.download("features/".concat(s.props.formId,".csv")),s.toggleDialog()},s.downloadFilteredFeaturesCsv=function(e){s.download("features/".concat(s.props.formId,".csv?").concat(s.props.filterParams)),s.toggleDialog()},s.toggleDialog=function(){return s.setState({openDialog:!s.state.openDialog})},s.state={activeBlob:"",downloadName:"",openDialog:!1,formArchivedOrDelete:!1},s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.archiveFormPromise&&this.archiveFormPromise.cancel(),this.deleteFormPromise&&this.deleteFormPromise.cancel()}},{key:"isAdmin",value:function(){return this.props.userDetails&&"admin"===this.props.userDetails.role}},{key:"renderDialog",value:function(){return c.a.createElement(h.a,{icon:"cloud-download",isOpen:this.state.openDialog,onClose:this.toggleDialog,title:"Download file"},c.a.createElement("div",{className:"pt-dialog-body"},this.state.downloadName?c.a.createElement("div",null,c.a.createElement("p",null,this.state.downloadName),c.a.createElement(f.a,{intent:g.a.PRIMARY,className:"pt-small",text:"Download",download:this.state.downloadName,href:this.state.activeBlob})):c.a.createElement("div",null,"Loading data, please wait...")))}},{key:"render",value:function(){var e=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",icon:"th",label:"Download CSV",onClick:this.downloadCsv}),c.a.createElement(E.a,{className:"pt-minimal",icon:"code",label:"Download JSON",onClick:this.downloadJson}),c.a.createElement(E.a,{className:"pt-minimal",icon:"compressed",label:"Download Attachments",onClick:this.downloadAttachments}),c.a.createElement(E.a,{className:"pt-minimal",icon:"th",label:"Download Filtered CSV",onClick:this.downloadFilteredCsv}),c.a.createElement(E.a,{className:"pt-minimal",icon:"code",label:"Download Filtered JSON",onClick:this.downloadFilteredJson}),c.a.createElement(E.a,{className:"pt-minimal",icon:"compressed",label:"Download Filtered Attachments",onClick:this.downloadFilteredAttachments})),t=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",label:"Data as OSM",onClick:this.downloadAllOsm}),c.a.createElement(E.a,{className:"pt-minimal",label:"Data as GeoJSON",onClick:this.downloadGeojson}),c.a.createElement(E.a,{className:"pt-minimal",label:"Data as CSV",onClick:this.downloadFeaturesCsv}),this.props.filterParams&&c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as OSM",onClick:this.downloadFilteredOsm}),c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as GeoJSON",onClick:this.downloadFilteredGeojson}),c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as CSV",onClick:this.downloadFilteredFeaturesCsv}))),a=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",icon:"add-to-folder",label:"Archive Form",onClick:this.archiveForm}),!this.props.hasSubmissions&&c.a.createElement(E.a,{className:"pt-minimal",icon:"trash",label:"Delete Form",onClick:this.deleteForm}));return c.a.createElement("div",null,this.state.formArchivedOrDelete?c.a.createElement(m.a,{to:"/"}):c.a.createElement("div",null,c.a.createElement(v.a,{content:e,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"link"},"ODK Data ",c.a.createElement(S.a,{icon:"caret-down"}))),c.a.createElement(v.a,{content:t,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"path-search"},"OSM Data ",c.a.createElement(S.a,{icon:"caret-down"}))),this.isAdmin()&&c.a.createElement(v.a,{content:a,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"cog"},"Manage ",c.a.createElement(S.a,{icon:"caret-down"}))),this.renderDialog()))}}]),a}(c.a.Component),M=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).download=function(t,a){s.setState({downloadName:""});var n=new e(s.props.userDetails.username+":"+s.props.userDetails.password).toString("base64");return fetch("/omk/data/submissions/".concat(t),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(n)}}).then(F.b).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e);s.setState({activeBlob:n}),s.setState({downloadName:a||t.split("?")[0]})})},s.downloadFile=function(e){s.download(s.props.urlEnding,s.props.filename),s.toggleDialog()},s.toggleDialog=function(){return s.setState({isOpen:!s.state.isOpen})},s.state={activeBlob:"",isOpen:!1},s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"renderDialog",value:function(){return c.a.createElement(h.a,{icon:"cloud-download",isOpen:this.state.isOpen,onClose:this.toggleDialog,title:"Download file"},c.a.createElement("div",{className:"pt-dialog-body"},this.state.downloadName?c.a.createElement("div",null,this.props.filename.endsWith(".jpg")||this.props.filename.endsWith(".png")?c.a.createElement(O.a,{src:this.state.activeBlob,responsive:!0,className:"preview-submission-img"}):c.a.createElement("p",null,this.props.filename),c.a.createElement(f.a,{intent:g.a.PRIMARY,className:"pt-small",text:"Download",download:this.props.filename,href:this.state.activeBlob})):c.a.createElement("div",null,"Loading data, please wait...")))}},{key:"render",value:function(){return this.props.filename?this.props.filename.endsWith(".osm")?c.a.createElement("div",null,c.a.createElement("a",{onClick:this.downloadFile},"OSM File"),this.renderDialog()):c.a.createElement("div",null,c.a.createElement("a",{onClick:this.downloadFile},"Download image"),this.renderDialog()):c.a.createElement("span",null,"No data")}}]),a}(c.a.Component),L=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).handleFilterStartDate=function(e){e?a.setState({startDate:e.toISOString().split("T")[0]}):a.setState({startDate:null})},a.handleFilterEndDate=function(e){e?a.setState({endDate:e.toISOString().split("T")[0]}):a.setState({endDate:null})},a.handleFilterDeviceIdChange=function(e){a.setState({filterDeviceId:e.target.value})},a.handleFilterUsernameChange=function(e){a.setState({filterUsername:e.target.value})},a.handlePageChange=function(e){a.setState({loading:!0}),a.setState({page:e.target.value}),setTimeout(function(){a.setState({loading:!1})},10)},a.handlePageSizeChange=function(e){a.setState({loading:!0,page:1}),a.setState({pageSize:e.target.value}),a.props.updatePageSize(e.target.value),a.updatePagination(e.target.value,a.state.filteredSubmissions),setTimeout(function(){a.setState({loading:!1})},10)},a.handleDataViewChange=function(e){a.props.updateDataView(e),a.setState({dataView:e})},a.filterSubmissions=function(){a.setState({loading:!0}),a.updateFilterParams(),a.setState({page:1});var e=a.state.submissions;a.state.startDate&&(e=e.filter(function(e){return p()(a.state.startDate).isBefore(e[3],"day")||p()(a.state.startDate).isSame(e[3],"day")})),a.state.endDate&&(e=e.filter(function(e){return p()(a.state.endDate).isAfter(e[3],"day")||p()(a.state.endDate).isSame(e[3],"day")})),a.state.filterDeviceId&&(e=e.filter(function(e){return e[2]&&e[2].toString().includes(a.state.filterDeviceId)})),a.state.filterUsername&&(e=e.filter(function(e){return e[2]&&e[2].toString().includes(a.state.filterUsername)})),a.setState({filteredSubmissions:e}),a.updatePagination(a.state.pageSize,e),a.setState({loading:!1})},a.clearFilter=function(){a.setState({loading:!0}),a.setState({filteredSubmissions:a.state.submissions}),a.setState({filterStartDate:null}),a.setState({filterEndDate:null}),a.setState({filterDeviceId:""}),a.setState({filterUsername:""}),a.updatePagination(a.state.pageSize,a.state.submissions),a.setState({loading:!1}),a.setState({filterParams:"offset=".concat((a.state.page-1)*a.state.pageSize||0,"&limit=").concat(a.state.pageSize)})},a.getFormDetails=function(){a.getFormDetailsPromise=Object(F.a)(Object(_.a)(a.props.formId)),a.getFormDetailsPromise.promise.then(function(e){a.setState({formName:e.xforms.xform[0].name}),a.setState({totalSubmissions:e.xforms.xform[0].totalSubmissions})}).catch(function(e){return console.log(e)})},a.getAuthStatus=function(){a.getAuthStatusPromise=Object(F.a)(Object(T.a)()),a.getAuthStatusPromise.promise.then(function(e){console.log("response "+e.auth_enabled),a.setState({authEnabled:e.auth_enabled})}).catch(function(e){return console.log(e)})},a.findImageValue=function(e){if(e.image)return e.image;var t=Object.values(e).filter(function(e){return"string"===typeof e}).filter(function(e){return e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".png")})[0];return t||Object.values(e).filter(function(e){return"object"===typeof e}).map(function(e){return Object.values(e)}).reduce(function(e,t){return t.concat(e)},[]).filter(function(e){return"string"===typeof e}).filter(function(e){return e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".png")})[0]},a.getSubmissions=function(){a.getSubmissionsPromise=Object(F.a)(Object(C.a)(a.props.formId,a.props.userDetails.username,a.props.userDetails.password)),a.getSubmissionsPromise.promise.then(function(e){var t=e.map(function(e){return[e.start,e.end?e.end:e.meta.submissionTime,e.username?e.username:e.deviceid,e.meta.submissionTime,a.findImageValue(e),Object.values(e).filter(function(e){return"string"===typeof e&&e.endsWith(".osm")})[0],e.meta.instanceId.split(":")[1]]});e.length>0&&e[0].hasOwnProperty("username")&&a.setState({hasUsername:!0}),a.updatePagination(a.state.pageSize,t),a.setState({submissions:t,filteredSubmissions:t,loading:!1})}).catch(function(e){console.log(e),a.setState({loading:!1})})},a.renderDateCell=function(e){return p()(e).format("lll")},a.renderCellImage=function(e,t){return e[t]?c.a.createElement(M,{urlEnding:"".concat(a.props.formId,"/").concat(e[t+2],"/").concat(e[t]),filename:e[t],userDetails:a.props.userDetails}):c.a.createElement("span",null,"No image")},a.renderCellLink=function(e,t){return c.a.createElement(M,{urlEnding:"".concat(a.props.formId,"/").concat(e[t+1],"/").concat(e[t]),filename:e[t],userDetails:a.props.userDetails})},a.state={submissions:[],filteredSubmissions:[],slicedSubmissions:[],loading:!0,formName:"",totalSubmissions:0,startDate:null,endDate:null,filterDeviceId:"",filterUsername:"",filterParams:"offset=0&limit=200",hasUsername:!1,dataView:e.dataView||"map",page:1,pageSize:e.pageSize||200,pageCount:1,authEnabled:!0},a}return Object(i.a)(t,e),Object(s.a)(t,[{key:"componentWillUnmount",value:function(){this.getSubmissionsPromise&&this.getSubmissionsPromise.cancel(),this.getFormDetailsPromise&&this.getFormDetailsPromise.cancel(),this.getAuthStatusPromise&&this.getAuthStatusPromise.cancel()}},{key:"componentDidMount",value:function(){this.getSubmissions(),this.getFormDetails(),this.props.userDetails&&null!=this.props.userDetails.username||this.getAuthStatus()}},{key:"componentDidUpdate",value:function(e,t){this.props.userDetails.username!==e.userDetails.username&&this.getSubmissions(),t.page===this.state.page&&t.pageSize===this.state.pageSize||this.updateFilterParams()}},{key:"updatePagination",value:function(e,t){if(t.length>e){var a=t.length%e;this.setState({pageCount:(t.length-a)/e+1})}else this.setState({pageCount:1})}},{key:"updateFilterParams",value:function(){var e={deviceId:this.state.filterDeviceId,start_date:this.state.startDate,end_date:this.state.endDate,username:this.state.filterUsername,offset:(this.state.page-1)*this.state.pageSize||0,limit:this.state.pageSize||200},t=Object.keys(e).filter(function(t){return e[t]}).reduce(function(t,a){return"".concat(t).concat(a,"=").concat(e[a],"&")},"");this.setState({filterParams:t})}},{key:"getPageSlice",value:function(){return this.state.filteredSubmissions.slice((this.state.page-1)*this.state.pageSize,this.state.page*this.state.pageSize)}},{key:"renderFilterSection",value:function(){var e=this.state.submissions.map(function(e){return e[2]});return e=e.filter(function(e){return void 0!==e}).filter(function(t,a){return e.indexOf(t)===a}),c.a.createElement(j.a,{className:"filters ml-0 mr-0"},c.a.createElement(j.a,{className:"ml-0 mr-0"},c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"start-date",className:"display-block"},"From",c.a.createElement(D.a,{content:"Based on the Submission Date",position:y.a.RIGHT},c.a.createElement(S.a,{icon:"help",color:"#CED9E0",className:"help-icon"}))),c.a.createElement(w.a,Object.assign({},x,{id:"start-date",onChange:this.handleFilterStartDate,popoverProps:B}))),c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"end-date",className:"display-block"},"To",c.a.createElement(D.a,{content:"Based on the Submission Date",position:y.a.RIGHT},c.a.createElement(S.a,{icon:"help",color:"#CED9E0",className:"help-icon"}))),c.a.createElement(w.a,Object.assign({},x,{id:"end-date",onChange:this.handleFilterEndDate,popoverProps:B})))),c.a.createElement(j.a,{className:"ml-0 mr-0"},this.state.hasUsername?c.a.createElement(N.a,{xs:12,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"filter-username",className:"display-block"},"Username"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handleFilterUsernameChange,value:this.state.filterUsername},c.a.createElement("option",{value:null},"Choose an item..."),e.map(function(e,t){return c.a.createElement("option",{key:t,value:"".concat(e)},e.toString())})))):c.a.createElement(N.a,{xs:12,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"filter-deviceid",className:"display-block"},"Device ID"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handleFilterDeviceIdChange,value:this.state.filterDeviceId},c.a.createElement("option",{value:null},"Choose an item..."),e.map(function(e,t){return c.a.createElement("option",{key:t,value:"".concat(e)},e.toString())}))))),c.a.createElement(j.a,{className:"ml-0 mr-0"},c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement(f.b,{className:"pt-intent-success filter-btn",icon:"filter",text:"Filter",onClick:this.filterSubmissions})),c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement(f.b,{className:"pt-intent-danger filter-btn",icon:"filter-remove",text:"Clear",onClick:this.clearFilter}))))}},{key:"renderTable",value:function(){var e=this;return this.state.loading?c.a.createElement("div",{id:"loading-msg"},"Loading data, please wait..."):0===this.state.filteredSubmissions.length?c.a.createElement("div",{id:"loading-msg"},"No data was found."):c.a.createElement("table",{className:"pt-html-table pt-html-table-bordered pt-interactive mb-20 mt-10"},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"Start"),c.a.createElement("th",null,"End"),this.state.hasUsername?c.a.createElement("th",null,"Username"):c.a.createElement("th",null,"Device ID"),c.a.createElement("th",null,"Submission Time"),c.a.createElement("th",null,"Image"),c.a.createElement("th",null,"Download"))),c.a.createElement("tbody",null,this.getPageSlice().map(function(t,a){return c.a.createElement("tr",{key:a},c.a.createElement("td",null,e.renderDateCell(t[0])),c.a.createElement("td",null,e.renderDateCell(t[1])),c.a.createElement("td",null,t[2]),c.a.createElement("td",null,e.renderDateCell(t[3])),c.a.createElement("td",null,e.renderCellImage(t,4)),c.a.createElement("td",null,e.renderCellLink(t,5)))})))}},{key:"renderMapSwitchButton",value:function(){var e=this;return c.a.createElement(j.a,{className:"ml-0 mr-0"},c.a.createElement(N.a,{xs:12},"map"===this.state.dataView?c.a.createElement(f.b,{className:"pt-intent",icon:"th",text:"Switch to Table view",onClick:function(){return e.handleDataViewChange("table")}}):c.a.createElement(f.b,{className:"pt-intent",icon:"map",text:"Switch to Map view",onClick:function(){return e.handleDataViewChange("map")}})))}},{key:"renderPagination",value:function(){return c.a.createElement(j.a,{className:"pagination pt-input-group ml-0 mr-0"},c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{className:"display-block"},"Page Size"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handlePageSizeChange,value:this.state.pageSize},[5e3,1e3,800,600,400,200,100,50,20].map(function(e,t){return c.a.createElement("option",{key:t,value:e},e.toString())})))),c.a.createElement(N.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{className:"display-block"},"Page"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handlePageChange},Array.apply(null,{length:this.state.pageCount}).map(Number.call,Number).map(function(e){return e+1}).map(function(e,t){return c.a.createElement("option",{key:t,value:e},e.toString())})))))}},{key:"render",value:function(){var e=this.props.userDetails&&null!=this.props.userDetails.username||!this.state.authEnabled;return c.a.createElement("div",null,e?c.a.createElement(k.a,{fluid:!0,className:"pl-0 pr-0"},c.a.createElement(j.a,{className:"ml-0 mr-0"},c.a.createElement(N.a,{xs:12,md:3,className:"sticky"},c.a.createElement("div",{className:"submissions-info"},c.a.createElement("h4",{className:"break-all"},this.state.formName),c.a.createElement("p",null,"Total submissions: ",this.state.totalSubmissions),c.a.createElement(U,{formId:this.props.formId,hasSubmissions:this.state.totalSubmissions>0,filterParams:this.state.filterParams,userDetails:this.props.userDetails})),this.renderFilterSection(),this.renderPagination(),this.renderMapSwitchButton()),c.a.createElement(N.a,{xs:12,md:9,className:"ml-0 mr-0 pr-0"},"map"===this.state.dataView?c.a.createElement(I.a,{userDetails:this.props.userDetails,formId:this.props.formId,filterParams:this.state.filterParams,hasUsername:this.state.hasUsername}):this.renderTable()))):c.a.createElement(A.a,null))}}]),t}(c.a.Component);L=Object(u.b)(function(e,t){return{userDetails:e.auth.userDetails,formId:t.match.params.formId,dataView:e.preferences.dataView,pageSize:e.preferences.pageSize}},function(e){return{updateDataView:function(t){return e(Object(z.a)(t))},updatePageSize:function(t){return e(Object(z.b)(t))}}})(L)}).call(this,a(43).Buffer)},151:function(e,t,a){"use strict";a.d(t,"a",function(){return S});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(12),l=a(0),c=a.n(l),u=a(98),m=a.n(u),d=a(58),p=a(152),h=a(153),f=a(266),g=a(70),b=a(8),E=a(89),v=["#29A634","#1F4B99","#D99E0B","#D13913","#8F398F","#00B3A4","#728C23","#DB2C6F","#B07B46","#7157D9","#B6D94C","#63411E"];function y(e,t){return e.sort(function(e,a){var n=e[t],s=a[t];return n>s?-1:n<s?1:0})}var S=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).map=null,a.state={info_content:"",display_map_info:"none",data:{},showVizTypeSwitch:!1,vizType:"default",legend:[],showLegend:!0},a}return Object(i.a)(t,e),Object(s.a)(t,[{key:"get_paint_property",value:function(e){return"default"===this.state.vizType?"#4580E6":"date"===this.state.vizType?this.get_color_steps_by_date(e):"user"===this.state.vizType?this.get_color_steps_by_user(e):void 0}},{key:"get_color_steps_by_date",value:function(e){var t=[],a=y(Object(h.array)(e.features.map(function(e){return new Date(e.properties.submission_date)})).filter(function(e){return e.count}),"count"),n=["match",["get","submission_date"]];return a.slice(0,12).map(function(e,a){n=n.concat([e.day,v[a]]),t.push([e.day,v[a]])}),n.push("#4580E6"),t.push(["Others","#4580E6"]),this.setState({legend:t}),n}},{key:"get_color_steps_by_user",value:function(e){var t,a,n=[];this.props.hasUsername?(t=e.features.map(function(e){return e.properties.submission_user}),a="submission_user"):(t=e.features.map(function(e){return e.properties.submission_deviceid}),a="submission_deviceid");var s=new d.Set(t),r=[];s.map(function(e){return r.push({user:e,count:t.filter(function(t){return t===e}).length})}),r=y(r,"count");var o=["match",["get",a]];return r.slice(0,12).map(function(e,t){o=o.concat([e.user,v[t]]),n.push([e.user,v[t]])}),o.push("#4580E6"),n.push(["Others","#4580E6"]),this.setState({legend:n}),o}},{key:"add_data_to_map",value:function(){var e=this;this.map.getSource("submissions")&&(["submission_areas","submission_lines","submission_points"].map(function(t){return e.map.removeLayer(t)}),this.map.removeSource("submissions")),Object(E.b)(this.props.formId,this.props.userDetails.username,this.props.userDetails.password,this.props.filterParams).then(function(t){e.setState({showVizTypeSwitch:!0}),t.features=t.features.filter(function(e){return Object.keys(e.properties).length>7}),e.setState({data:t});var a=e.get_paint_property(t);e.map.addSource("submissions",{type:"geojson",data:t}),e.map.addLayer({id:"submission_lines",type:"line",source:"submissions",filter:["==","$type","LineString"],paint:{"line-color":a,"line-width":3}}),e.map.addLayer({id:"submission_areas",type:"fill",source:"submissions",filter:["in","$type","Polygon"],paint:{"fill-color":a,"fill-opacity":.4,"fill-outline-color":"#61FC03"}}),e.map.addLayer({id:"submission_points",type:"circle",source:"submissions",filter:["==","$type","Point"],paint:{"circle-color":a,"circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),e.map.fitBounds(Object(p.extent)(t),{padding:{top:80,bottom:35,left:35,right:35},linear:!0})}),this.map.resize()}},{key:"componentDidUpdate",value:function(e,t){if(this.props.filterParams!==e.filterParams&&this.add_data_to_map(),this.state.vizType!==t.vizType){var a=this.get_paint_property(this.state.data);this.map.setPaintProperty("submission_lines","line-color",a),this.map.setPaintProperty("submission_areas","fill-color",a),this.map.setPaintProperty("submission_points","circle-color",a)}}},{key:"componentDidMount",value:function(){var e=this;m.a.accessToken="pk.eyJ1IjoiaG90IiwiYSI6IlBtUmNiR1kifQ.dCS1Eu9DIRNZGktc24IwtA",this.map=new m.a.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9"}),this.map.addControl(new m.a.NavigationControl,"top-right"),this.map.on("load",function(){e.add_data_to_map()}),this.map.on("click",function(t){var a=[t.point.x-5,t.point.y-5],n=[t.point.x+5,t.point.y+5],s=e.map.queryRenderedFeatures([a,n],{layers:["submission_areas","submission_lines","submission_points"]});if(s.length){var r=function(e){var t={};return Object.keys(e).sort().forEach(function(a){t[a]=e[a]}),t}(s[0].properties),o=Object.keys(r),i=Object.values(r);e.setState({info_content:o.map(function(e,t){return c.a.createElement("tr",{key:t},c.a.createElement("td",{className:"feature-key"},e),c.a.createElement("td",{className:"feature-value"},i[t]))})}),e.setState({display_map_info:"block"})}else e.setState({display_map_info:"none",info_content:""})}),["submission_areas","submission_lines","submission_points"].forEach(function(t){e.map.on("mouseenter",t,function(){e.map.getCanvas().style.cursor="pointer"}),e.map.on("mouseleave",t,function(){e.map.getCanvas().style.cursor=""})})}},{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement("div",{id:"map"},this.state.info_content&&c.a.createElement("div",{className:"map-info display-block"},c.a.createElement("table",null,c.a.createElement("tbody",null,this.state.info_content))),this.state.showVizTypeSwitch&&c.a.createElement("div",{className:"color-switch"},c.a.createElement(f.a,{label:"Features colouring",onChange:function(t){return e.setState({vizType:t.target.value})},selectedValue:this.state.vizType},c.a.createElement(g.a,{label:"Default Color",value:"default"}),c.a.createElement(g.a,{label:"By Submission Date",value:"date"}),c.a.createElement(g.a,{label:"By ".concat(this.props.hasUsername?"User":"Device ID"),value:"user"})),"default"!==this.state.vizType&&c.a.createElement("div",null,c.a.createElement("label",{id:"legend-label",className:"pt-label",onClick:function(t){return e.setState({showLegend:!e.state.showLegend})}},this.state.showLegend?c.a.createElement(b.a,{icon:"chevron-down"}):c.a.createElement(b.a,{icon:"chevron-right"}),"Legend"),this.state.showLegend&&this.state.legend.map(function(e,t){return c.a.createElement("div",{key:t},c.a.createElement(b.a,{icon:"full-circle",color:"".concat(e[1])})," ",c.a.createElement("span",null,e[0]))})))))}}]),t}(c.a.Component)},159:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return h});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(12),l=a(0),c=a.n(l),u=a(18),m=a(94),d=a(71),p=a(8),h=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).state={success:!1,error:!1,loadingIndicator:!1,errorMessage:""},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"render",value:function(){var e=this,t={action:"/omk/odk/upload-form",headers:{Authorization:"Basic ".concat(this.authBase64)},multiple:!0,beforeUpload:function(e){console.log("beforeUpload",e.name)},onStart:function(t){e.setState({loadingIndicator:!0,error:!1,success:!1}),console.log("onStart",t.name)},onSuccess:function(t){e.setState({loadingIndicator:!1,error:!1,success:!0}),console.log("onSuccess",t)},onProgress:function(e,t){console.log("onProgress",Math.round(e.percent),t.name)},onError:function(t,a){e.setState({loadingIndicator:!1,error:!0,success:!1,errorMessage:a.msg})}};return c.a.createElement("div",{className:"container"},this.state.success&&c.a.createElement(d.a,{title:"Success!",intent:"success",className:"upload-result"},"Your file(s) has been successfully uploaded and the new forms are already available"),this.state.error&&c.a.createElement(d.a,{title:"Error!",intent:"danger",className:"upload-result"},this.state.errorMessage?this.state.errorMessage:"Some error occurred while uploading your file(s)"),c.a.createElement(m.a,Object.assign({},t,{ref:"inner"}),c.a.createElement(d.a,{title:this.state.loadingIndicator?"Uploading...":"Upload Form",className:"upload-area ".concat(this.state.loadingIndicator&&"loading-upload-area")},c.a.createElement("div",{className:"pt-10"},this.state.loadingIndicator?c.a.createElement(p.a,{icon:"refresh",className:"spinning",iconSize:60,title:"Uploading..."}):c.a.createElement("p",null,"Drag and drop here your XSL or XSLX files to upload to OpenMapKit Server.")))))}}]),a}(c.a.Component);h=Object(u.b)(function(e){return{userDetails:e.auth.userDetails}})(h)}).call(this,a(43).Buffer)},162:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return y});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(12),l=a(0),c=a.n(l),u=a(18),m=a(168),d=a(94),p=a(71),h=a(8),f=a(28),g=a(35),b=a(22),E=a(5),v=a(75),y=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).getDeployments=function(){s.getDeploymentsPromise=Object(E.a)(Object(v.b)()),s.getDeploymentsPromise.promise.then(function(e){return s.setState({files:e.filter(function(e){return e.name===s.props.deployment})[0].files})}).catch(function(e){return console.log(e)})},s.bytesToSize=function(e){if(!e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]},s.state={success:!1,error:!1,files:[],loadingIndicator:!1,errorMessage:""},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.getDeployments&&this.getDeploymentsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getDeployments()}},{key:"render",value:function(){var e=this,t={action:"/omk/odk/deployments/".concat(this.props.deployment),headers:{Authorization:"Basic ".concat(this.authBase64)},multiple:!0,beforeUpload:function(e){console.log("beforeUpload",e.name)},onStart:function(t){e.setState({loadingIndicator:!0,error:!1,success:!1}),console.log("onStart",t.name)},onSuccess:function(t){e.setState({loadingIndicator:!1,error:!1,success:!0}),e.getDeployments(),console.log("onSuccess",t)},onProgress:function(e,t){console.log("onProgress",Math.round(e.percent),t.name)},onError:function(t,a){e.setState({loadingIndicator:!1,error:!0,success:!1,errorMessage:a.msg})}};return c.a.createElement("div",{className:"container mt-10 mb-20"},this.state.success&&c.a.createElement(p.a,{title:"Success!",intent:"success",className:"upload-result"},"Your file(s) has been successfully uploaded and are already available on the deployments"),this.state.error&&c.a.createElement(p.a,{title:"Error!",intent:"danger",className:"upload-result"},this.state.errorMessage?this.state.errorMessage:"Some error occurred while uploading your file(s)"),c.a.createElement("div",{className:"deployments mt-20"},c.a.createElement("h3",null,"Deployment - ",c.a.createElement("i",null,this.props.deployment)),c.a.createElement("hr",null),c.a.createElement(g.a,{className:"ml-0 mr-0 mt-20 pt-10 pb-10 light-gray-5"},c.a.createElement("h4",null,"Current files"),c.a.createElement(b.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".geojson")),this.state.files&&this.state.files.geojson&&this.state.files.geojson.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))})),c.a.createElement(b.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".mbtiles")),this.state.files&&this.state.files.mbtiles&&this.state.files.mbtiles.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))})),c.a.createElement(b.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".osm")),this.state.files&&this.state.files.osm&&this.state.files.osm.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))}))),c.a.createElement("hr",null),c.a.createElement(d.a,Object.assign({},t,{ref:"inner"}),c.a.createElement(p.a,{title:this.state.loadingIndicator?"Uploading...":"Upload Form",className:"upload-area ".concat(this.state.loadingIndicator&&"loading-upload-area")},c.a.createElement("div",{className:"pt-10"},this.state.loadingIndicator?c.a.createElement(h.a,{icon:"refresh",className:"spinning",iconSize:60,title:"Uploading..."}):c.a.createElement("p",null,"Drag and drop here new deployment files.",c.a.createElement("br",null),"Accepted formats: ",c.a.createElement("code",null,".geojson"),", ",c.a.createElement("code",null,".mbtiles"),", ",c.a.createElement("code",null,".osm"))))),c.a.createElement(m.a,{to:"/deployments"},c.a.createElement(f.b,{className:"pt-button pt-intent-warning mt-10"},c.a.createElement("span",{className:"pt-icon-standard pt-icon-arrow-left pt-align-left"}),"Select another folder"))))}}]),a}(c.a.Component);y=Object(u.b)(function(e,t){return{userDetails:e.auth.userDetails,deployment:t.match.params.deployment}})(y)}).call(this,a(43).Buffer)},163:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return y});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(12),l=a(0),c=a.n(l),u=a(18),m=a(168),d=a(28),p=a(170),h=a(35),f=a(22),g=a(268),b=a(99),E=a(5),v=a(75),y=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).getDeployments=function(){s.getDeploymentsPromise=Object(E.a)(Object(v.b)()),s.getDeploymentsPromise.promise.then(function(e){return s.setState({deployments:e})}).catch(function(e){return console.log(e)})},s.selectDeployment=function(e){s.setState({selectedDeployment:e})},s.unselectDeployment=function(){s.getDeployments(),s.setState({selectedDeployment:""})},s.newFolderNameValue=function(e){s.setState({newDeploymentName:e.target.value,folderNameAlreadyExists:e.target.value&&s.state.deployments.map(function(e){return e.name}).includes(e.target.value),validFolderName:!/[^a-zA-Z0-9\-\/]/.test(e.target.value)})},s.createDeploymentFolder=function(){s.createDeploymentPromise=Object(E.a)(Object(v.a)(s.state.newDeploymentName,s.props.userDetails.username,s.props.userDetails.password)),s.createDeploymentPromise.promise.then(function(e){s.setState({newDeploymentName:""}),s.getDeployments()}).catch(function(e){return console.log(e)})},s.state={deployments:[],selectedDeployment:"",newDeploymentName:"",folderNameAlreadyExists:!1,validFolderName:!1},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.getDeployments&&this.getDeploymentsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getDeployments()}},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"container"},c.a.createElement("div",{className:"deployments mt-20 mb-20"},c.a.createElement("h2",null,"Deployments"),c.a.createElement("p",null," Select a deployment folder to upload files to:"),c.a.createElement(p.a,{className:"deployments-list"},c.a.createElement(h.a,null,c.a.createElement(f.a,{xs:12,md:6,mdOffset:3},this.state.deployments.length?c.a.createElement(g.a,null,this.state.deployments.map(function(e,t){return c.a.createElement(b.a,{key:t},c.a.createElement("div",null,c.a.createElement(m.a,{to:"/deployments/".concat(e.name)},c.a.createElement("h3",{className:"display-inline"},e.name))))})):c.a.createElement("span",null,"No deployments were found.")))),c.a.createElement("div",{className:"mb-10"},c.a.createElement("p",null,"Or create a new deployment folder:"),c.a.createElement("input",{type:"text",dir:"auto",placeholder:"New folder name",value:this.state.newDeploymentName,className:"pt-input mb-10 ".concat(this.state.folderNameAlreadyExists&&"pt-intent-danger"),onChange:function(t){return e.newFolderNameValue(t)}}),this.state.folderNameAlreadyExists&&c.a.createElement("p",{className:"deployment-alert"},"There is already a deployment folder with this name."),this.state.newDeploymentName&&!this.state.validFolderName&&c.a.createElement("p",{className:"deployment-alert"},"Please don't use spaces or special characters on the folder name."),this.state.newDeploymentName&&!this.state.folderNameAlreadyExists&&this.state.validFolderName&&c.a.createElement("p",null,c.a.createElement(d.b,{className:"pt-button pt-intent-success",onClick:function(t){return e.createDeploymentFolder()}},"Create folder",c.a.createElement("span",{className:"pt-icon-standard pt-icon-arrow-right pt-align-right"}))))))}}]),a}(c.a.Component);y=Object(u.b)(function(e){return{userDetails:e.auth.userDetails}})(y)}).call(this,a(43).Buffer)},176:function(e,t,a){e.exports=a(265)},191:function(e,t,a){},261:function(e,t,a){},265:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(29),o=a.n(r),i=a(273),l=a(18),c=a(166),u=a.n(c),m=(a(185),a(186),a(187),a(188),a(189),a(190),a(191),a(9)),d=a(10),p=a(13),h=a(11),f=a(12),g=a(272),b=a(168),E=a(67),v=a(23),y=a(34),S=a(14),D=a(28),w=a(274),O=a(148),j=a(149),N=a(57),k=a(87),C=a(5),P=a(147),F=a.n(P),_=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(p.a)(this,Object(h.a)(t).call(this,e))).getAuthStatus=function(){a.getAuthStatusPromise=Object(C.a)(Object(k.a)()),a.getAuthStatusPromise.promise.then(function(e){a.setState({authEnabled:e.auth_enabled})}).catch(function(e){return console.log(e)})},a.state={authEnabled:!0},a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.props.userDetails&&null!=this.props.userDetails.username||this.getAuthStatus()}},{key:"isAuthenticated",value:function(){return this.props.userDetails&&null!=this.props.userDetails.username}},{key:"isAdmin",value:function(){return this.props.userDetails&&"admin"===this.props.userDetails.role||!this.state.authEnabled}},{key:"renderAuthSubMenu",value:function(){if(this.state.authEnabled){if(this.isAuthenticated()){var e=s.a.createElement(E.a,null,s.a.createElement(v.a,{className:"pt-minimal",icon:"log-out",label:"Logout",onClick:this.props.doLogout}));return s.a.createElement(y.a,{content:e,position:S.a.BOTTOM,className:"pt-intent-default"},s.a.createElement(D.b,{icon:"user",text:this.props.userDetails.username}))}return s.a.createElement(b.a,{to:"/login"},s.a.createElement(D.b,{className:"pt-minimal",icon:"user"},"Log in"))}}},{key:"render",value:function(){return s.a.createElement(w.a,{className:"default-green-bg pt-dark",fixedToTop:!0},s.a.createElement(O.a,null,s.a.createElement("img",{className:"pt-icon main-logo pt-align-left",src:F.a,alt:"omk logo"}),s.a.createElement(j.a,null,s.a.createElement(b.a,{to:"/"},s.a.createElement("h3",null,"OpenMapKit Server")))),s.a.createElement(O.a,{align:"right"},s.a.createElement(b.a,{to:"/"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"home"},"Home")),this.isAdmin()&&s.a.createElement(b.a,{to:"/deployments"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"cloud-upload"},"Deployments")),this.isAdmin()&&s.a.createElement(b.a,{to:"/upload-form"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"cloud-upload"},"Upload Form")),this.isAdmin()&&s.a.createElement(b.a,{to:"/archived-forms"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"folder-close"},"Archived Forms")),this.renderAuthSubMenu()))}}]),t}(s.a.Component);_=Object(l.b)(function(e){return{userDetails:e.auth.userDetails}},function(e){return{doLogout:function(){return e(Object(N.b)())}}})(_);var T=a(150),I=a(91),A=a(167),z=a(58),x=a(68),B=a(271),U=a(22),M=a(170),L=a(35),R=a(90),V=a(158),W=a.n(V);var X=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"renderCol",value:function(e){return s.a.createElement(x.a,{interactive:!0,elevation:x.b.TWO},s.a.createElement("h5",{className:"card-title"},e.get("name")),s.a.createElement("div",{className:"text-left form-info"},s.a.createElement("p",null,"Number of Submissions: ",e.get("totalSubmissions")),s.a.createElement("p",null,"Form ID: ",s.a.createElement("code",null,e.get("formID"))),s.a.createElement(B.a,{fill:!0,vertical:!0,large:!1},s.a.createElement(b.a,{to:"/submissions/".concat(e.get("formID"))},s.a.createElement(D.b,{icon:"list"},"View submissions")),s.a.createElement(D.a,{icon:"th",download:!0,href:"/omk/data/forms/".concat(e.get("formID"),".xlsx")},"XSLX Form"),s.a.createElement(D.a,{icon:"code",download:!0,href:"/omk/data/forms/".concat(e.get("formID"),".xml")},"XForm XML"))))}},{key:"renderRow",value:function(e,t){var a=this;return e.slice(4*t,4*(t+1)).map(function(e,t){return s.a.createElement(U.a,{key:t,md:3,xs:12,className:"forms-col"},a.renderCol(e))})}},{key:"render",value:function(){var e=this,t=[],a=0;try{a=(t=this.props.data.get("data").get("xforms").get("xform")).size}catch(r){TypeError}var n=Math.floor(a/4);return s.a.createElement(M.a,{className:"forms-grid"},Object(A.a)(Array(n+1).keys()).map(function(a){return s.a.createElement(L.a,{key:a,className:"forms-row"},e.renderRow(t,a))}))}}]),t}(s.a.Component);X=function(e,t,a){var n,r;return r=n=function(n){function r(t){var a;return Object(m.a)(this,r),(a=Object(p.a)(this,Object(h.a)(r).call(this,t))).state={data:Object(z.Map)()},a._initFetching=function(t){a.fetchedData=e(t),Object.keys(a.fetchedData).forEach(function(e){a.fetchedData[e].promise.then(function(t){var n=a.state.data;n=n.set(e,Object(z.fromJS)(t)),a.setState({data:n})}).catch(function(e){return console.error(e)})})},a.reloadData=function(){a.initFetching(a.props)},a.initFetching=W()(a._initFetching,500),a}return Object(f.a)(r,n),Object(d.a)(r,[{key:"componentDidMount",value:function(){this.initFetching(this.props)}},{key:"componentWillReceiveProps",value:function(e){t(e,this.props)&&this.initFetching(e)}},{key:"componentWillUnmount",value:function(){var e=this;this.fetchedData&&Object.keys(this.fetchedData).forEach(function(t){e.fetchedData[t]&&e.fetchedData[t].cancel()})}},{key:"render",value:function(){return s.a.createElement(a,Object.assign({},this.props,{data:this.state.data,reloadData:this.reloadData}))}}]),r}(s.a.PureComponent),n.displayName="HOCFetchData".concat(function(e){return e.displayName||e.name||"Component"}(a)),r}(function(e){return{data:Object(C.a)(Object(R.a)())}},function(e,t){return!0},X);var G=a(159),q=a(99),J=a(268),H=a(65),Y=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={visible:!0},a.restoreForm=function(e){a.restoreFormPromise=Object(C.a)(Object(H.d)(a.props.formName,a.props.userDetails.username,a.props.userDetails.password)),a.restoreFormPromise.promise.then(function(e){a.setState({visible:!1})}).catch(function(e){return console.log(e)})},a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentWillUnmount",value:function(){this.restoreFormPromise&&this.restoreFormPromise.cancel()}},{key:"render",value:function(){return s.a.createElement(q.a,null,this.state.visible?s.a.createElement("div",null,s.a.createElement("h3",{className:"display-inline"},this.props.formName),s.a.createElement(D.b,{className:"display-inline restore-btn",icon:"refresh",intent:"warning",text:"Restore",onClick:this.restoreForm})):s.a.createElement("div",null,s.a.createElement("h3",null,"Form Restored")))}}]),t}(s.a.Component),Z=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={forms:[]},a.getArchivedForms=function(){a.getArchivedFormsPromise=Object(C.a)(Object(H.b)(a.props.userDetails.username,a.props.userDetails.password)),a.getArchivedFormsPromise.promise.then(function(e){return a.setState({forms:e.forms})}).catch(function(e){return console.log(e)})},a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentWillUnmount",value:function(){this.getArchivedFormsPromise&&this.getArchivedFormsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getArchivedForms()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"archived-forms"},s.a.createElement("h2",null,"Archived Forms"),s.a.createElement(M.a,{className:"archived-form-list"},s.a.createElement(L.a,null,s.a.createElement(U.a,{xs:12,md:6,mdOffset:3},this.state.forms.length?s.a.createElement(J.a,null,this.state.forms.map(function(t,a){return s.a.createElement(Y,{key:a,userDetails:e.props.userDetails,formName:t})})):s.a.createElement("span",null,"No archived forms were found.")))))}}]),t}(s.a.Component);Z=Object(l.b)(function(e,t){return{userDetails:e.auth.userDetails}})(Z);var K=a(162),$=a(163),Q=(a(261),function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(_,null),s.a.createElement("div",{className:"top-50"},s.a.createElement(g.a,{exact:!0,path:"/",component:X}),s.a.createElement(g.a,{exact:!0,path:"/login",component:I.a}),s.a.createElement(g.a,{exact:!0,path:"/upload-form",component:G.a}),s.a.createElement(g.a,{exact:!0,path:"/archived-forms",component:Z}),s.a.createElement(g.a,{exact:!0,path:"/deployments",component:$.a}),s.a.createElement(g.a,{exact:!0,path:"/deployments/:deployment",component:K.a}),s.a.createElement(g.a,{exact:!0,path:"/submissions/:formId",component:T.a})))}}]),t}(n.Component)),ee=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function te(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ae=a(39),ne=a(165),se=a.n(ne),re=a(93),oe=a(164),ie=a(15),le={userDetails:new Map};var ce=a(66),ue={pageSize:200,dataView:"map"};var me=Object(ae.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N.c.SET_USER:return{userDetails:t.userDetails};default:return e}},preferences:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ce.c.SET_PAGE_SIZE:return{pageSize:t.pageSize,dataView:e.dataView};case ce.c.SET_DATA_VIEW:return{pageSize:e.pageSize,dataView:t.dataView};default:return e}},router:re.routerReducer}),de={auth:{userDetails:{id:ie.a("username"),username:ie.a("username"),password:ie.a("password"),role:ie.a("role")}},preferences:{dataView:ie.a("dataView"),pageSize:ie.a("pageSize")}},pe=se()(),he=[oe.a,Object(re.routerMiddleware)(pe)],fe=ae.d.apply(void 0,[ae.a.apply(void 0,he)].concat([])),ge=Object(ae.e)(me,de,fe),be=u()();o.a.render(s.a.createElement(l.a,{store:ge},s.a.createElement(i.a,{history:be},s.a.createElement(Q,null))),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/omk/pages",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/omk/pages","/service-worker.js");ee?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):te(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):te(e)})}}()},5:function(e,t,a){"use strict";function n(e){var t=!1;return{promise:new Promise(function(a,n){e.then(function(e){return t?n({isCanceled:!0}):a(e)}).catch(function(e){return n(t?{isCanceled:!0}:e)})}),cancel:function(){t=!0}}}function s(e){if(!e.ok)throw Error(e.statusText);return e}a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s})},57:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"b",function(){return r}),a.d(t,"a",function(){return o});var n=a(15),s={SET_USER:"SET_USER",CLEAR_USER:"CLEAR_USER"};var r=function(){return function(e){n.b("id"),n.b("username"),n.b("password"),n.b("role"),e({type:s.SET_USER,userDetails:{}})}},o=function(e,t){return function(a){fetch("/omk/login/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then(function(e){return e.json()}).then(function(e){n.c("id",e.user.id),n.c("username",e.user.username),n.c("password",e.user.password),n.c("role",e.user.role),a(function(e){return{type:s.SET_USER,userDetails:e}}(e.user))}).catch(function(e){return console.warn(e)})}}},65:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return s}),a.d(t,"d",function(){return r}),a.d(t,"a",function(){return o}),a.d(t,"c",function(){return i});var n=a(5);function s(t,a){var s=new e(t+":"+a).toString("base64");return fetch("/omk/odk/archived-forms",{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(s)}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/restore");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function o(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/archive");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function i(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/delete");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}}).call(this,a(43).Buffer)},66:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"a",function(){return r}),a.d(t,"b",function(){return o});var n=a(15),s={SET_PAGE_SIZE:"SET_PAGE_SIZE",SET_DATA_VIEW:"SET_DATA_VIEW"};var r=function(e){return function(t){n.c("dataView",e),t(function(e){return{type:s.SET_DATA_VIEW,dataView:e}}(e))}},o=function(e){return function(t){n.c("pageSize",e),t(function(e){return{type:s.SET_PAGE_SIZE,pageSize:e}}(e))}}},75:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return s}),a.d(t,"a",function(){return r});var n=a(5);function s(e){return fetch("/omk/deployments/",{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s){var r=new e(a+":"+s).toString("base64");return fetch("/omk/odk/deployments/",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)},body:JSON.stringify({name:t})}).then(n.b).then(function(e){return e.json()})}}).call(this,a(43).Buffer)},87:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(5);function s(){return fetch("/omk/auth-status/",{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}},89:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return s}),a.d(t,"b",function(){return r});var n=a(5);function s(t,a,s){var r=new e(a+":"+s).toString("base64");return fetch("/omk/odk/submissions/".concat(t,".json?offset=0&limit=5000"),{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s,r){var o=new e(a+":"+s).toString("base64"),i="/omk/odk/submissions/".concat(t,".geojson?").concat(r);return fetch(i,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(o)}}).then(n.b).then(function(e){return e.json()})}}).call(this,a(43).Buffer)},90:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(5);function s(e){var t="/formList?json=true";return e&&(t="/formList?json=true&formid=".concat(e)),fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}},91:function(e,t,a){"use strict";a.d(t,"a",function(){return f});var n=a(9),s=a(10),r=a(13),o=a(11),i=a(62),l=a(12),c=a(0),u=a.n(c),m=a(18),d=a(172),p=a(28),h=a(57),f=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).onSubmit=function(e){e.preventDefault(),a.props.authenticateUser(a.state.username,a.state.password),a.setState({triedToLogin:!0})},a.state={username:e.username?e.username:"",password:"",triedToLogin:!1},a.onSubmit=a.onSubmit.bind(Object(i.a)(a)),a.changeUsername=a.changeUsername.bind(Object(i.a)(a)),a.changePassword=a.changePassword.bind(Object(i.a)(a)),a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"changeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"changePassword",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){return u.a.createElement("div",{className:"pt-input-group login center-block"},this.props.username?u.a.createElement(d.a,{to:"/"}):u.a.createElement("div",null,u.a.createElement("form",{onSubmit:this.onSubmit},u.a.createElement("h2",null,"Sign in"),this.state.triedToLogin&&u.a.createElement("div",{className:"pt-callout pt-intent-danger"},u.a.createElement("h4",{className:"pt-callout-title"},"Login failed"),"Verify your username or password."),u.a.createElement("input",{type:"text",className:"pt-input mt-10",value:this.state.username,onChange:this.changeUsername,placeholder:"Username"}),u.a.createElement("input",{type:"password",className:"pt-input mt-10",value:this.state.password,onChange:this.changePassword,placeholder:"Enter your password..."}),u.a.createElement(p.b,{type:"submit",className:"pt-large",intent:"success",icon:"log-in",text:"Sign In"}))))}}]),t}(u.a.Component);f=Object(m.b)(function(e){return{username:e.auth.userDetails?e.auth.userDetails.username:""}},function(e){return{authenticateUser:function(t,a){return e(Object(h.a)(t,a))}}})(f)}},[[176,1,2]]]);
//# sourceMappingURL=main.390b8372.chunk.js.map