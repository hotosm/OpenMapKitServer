(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{115:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return s}),a.d(t,"a",function(){return r});var n=a(7);function s(e){return fetch("/omk/deployments/",{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s){var r=new e(a+":"+s).toString("base64");return fetch("/omk/odk/deployments/",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)},body:JSON.stringify({name:t})}).then(n.b).then(function(e){return e.json()})}}).call(this,a(38).Buffer)},116:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(7);function s(){return fetch("/omk/auth-status/",{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}},140:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return d});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(0),c=a.n(l),u=a(20),m=a(118),p=a(114),d=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).state={success:!1,error:!1},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"render",value:function(){var e=this,t={action:"/omk/odk/upload-form",headers:{Authorization:"Basic ".concat(this.authBase64)},multiple:!0,beforeUpload:function(e){console.log("beforeUpload",e.name)},onStart:function(t){e.setState({error:!1}),e.setState({success:!1}),console.log("onStart",t.name)},onSuccess:function(t){e.setState({success:!0}),e.setState({error:!1}),console.log("onSuccess",t)},onProgress:function(e,t){console.log("onProgress",Math.round(e.percent),t.name)},onError:function(t){e.setState({error:!0}),e.setState({success:!1})}};return c.a.createElement("div",{className:"container"},this.state.success&&c.a.createElement(p.a,{title:"Success!",intent:"success",className:"upload-result"},"Your file(s) has been successfully uploaded and the new forms are already available"),this.state.error&&c.a.createElement(p.a,{title:"Error!",intent:"danger",className:"upload-result"},"Some error occurred while uploading your file(s)."),c.a.createElement(m.a,Object.assign({},t,{ref:"inner"}),c.a.createElement(p.a,{title:"Upload Form",className:"upload-area"},"Drag and drop here your XSL or XSLX files to upload to OpenMapKit Server.")))}}]),a}(c.a.Component);d=Object(u.b)(function(e){return{userDetails:e.auth.userDetails}})(d)}).call(this,a(38).Buffer)},143:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return v});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(0),c=a.n(l),u=a(20),m=a(273),p=a(118),d=a(114),h=a(288),f=a(282),g=a(283),b=a(7),E=a(115),v=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).getDeployments=function(){s.getDeploymentsPromise=Object(b.a)(Object(E.b)()),s.getDeploymentsPromise.promise.then(function(e){return s.setState({files:e.filter(function(e){return e.name===s.props.deployment})[0].files})}).catch(function(e){return console.log(e)})},s.bytesToSize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]},s.state={success:!1,error:!1,files:[]},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.getDeployments&&this.getDeploymentsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getDeployments()}},{key:"render",value:function(){var e=this,t={action:"/omk/odk/deployments/".concat(this.props.deployment),headers:{Authorization:"Basic ".concat(this.authBase64)},multiple:!0,beforeUpload:function(e){console.log("beforeUpload",e.name)},onStart:function(t){e.setState({error:!1}),e.setState({success:!1}),console.log("onStart",t.name)},onSuccess:function(t){e.setState({success:!0}),e.setState({error:!1}),e.getDeployments(),console.log("onSuccess",t)},onProgress:function(e,t){console.log("onProgress",Math.round(e.percent),t.name)},onError:function(t){e.setState({error:!0}),e.setState({success:!1})}};return c.a.createElement("div",{className:"container mt-10 mb-20"},this.state.success&&c.a.createElement(d.a,{title:"Success!",intent:"success",className:"upload-result"},"Your file(s) has been successfully uploaded and are already available on the deployments"),this.state.error&&c.a.createElement(d.a,{title:"Error!",intent:"danger",className:"upload-result"},"Some error occurred while uploading your file(s)."),c.a.createElement("div",{className:"deployments mt-20"},c.a.createElement("h3",null,"Deployment - ",c.a.createElement("i",null,this.props.deployment)),c.a.createElement("hr",null),c.a.createElement(f.a,{className:"ml-0 mr-0 mt-20 pt-10 pb-10 light-gray-5"},c.a.createElement("h4",null,"Current files"),c.a.createElement(g.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".geojson")),this.state.files&&this.state.files.geojson&&this.state.files.geojson.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url,target:"_blank"},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))})),c.a.createElement(g.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".mbtiles")),this.state.files&&this.state.files.mbtiles&&this.state.files.mbtiles.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))})),c.a.createElement(g.a,{xs:12,md:4,className:"pt-input-group"},c.a.createElement("p",null,c.a.createElement("b",null,".osm")),this.state.files&&this.state.files.osm&&this.state.files.osm.map(function(t){return c.a.createElement("p",null,c.a.createElement("a",{href:t.url,target:"_blank"},t.name)," ",c.a.createElement("i",null,"(",e.bytesToSize(t.size),")"))}))),c.a.createElement("hr",null),c.a.createElement(p.a,Object.assign({},t,{ref:"inner"}),c.a.createElement(d.a,{title:"Upload new files",className:"upload-area"},"Drag and drop here new deployment files.",c.a.createElement("br",null),"Accepted formats: ",c.a.createElement("code",null,".geojson"),", ",c.a.createElement("code",null,".mbtiles"),", ",c.a.createElement("code",null,".osm"))),c.a.createElement(m.a,{to:"/deployments"},c.a.createElement(h.b,{className:"pt-button pt-intent-warning mt-10"},c.a.createElement("span",{className:"pt-icon-standard pt-icon-arrow-left pt-align-left"}),"Select another folder"))))}}]),a}(c.a.Component);v=Object(u.b)(function(e,t){return{userDetails:e.auth.userDetails,deployment:t.match.params.deployment}})(v)}).call(this,a(38).Buffer)},165:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return y});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(0),c=a.n(l),u=a(20),m=a(273),p=a(288),d=a(284),h=a(282),f=a(283),g=a(290),b=a(164),E=a(7),v=a(115),y=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).getDeployments=function(){s.getDeploymentsPromise=Object(E.a)(Object(v.b)()),s.getDeploymentsPromise.promise.then(function(e){return s.setState({deployments:e})}).catch(function(e){return console.log(e)})},s.selectDeployment=function(e){s.setState({selectedDeployment:e})},s.unselectDeployment=function(){s.getDeployments(),s.setState({selectedDeployment:""})},s.newFolderNameValue=function(e){s.setState({newDeploymentName:e.target.value,folderNameAlreadyExists:e.target.value&&s.state.deployments.map(function(e){return e.name}).includes(e.target.value),validFolderName:!/[^a-zA-Z0-9\-\/]/.test(e.target.value)})},s.createDeploymentFolder=function(){s.createDeploymentPromise=Object(E.a)(Object(v.a)(s.state.newDeploymentName,s.props.userDetails.username,s.props.userDetails.password)),s.createDeploymentPromise.promise.then(function(e){s.setState({newDeploymentName:""}),s.getDeployments()}).catch(function(e){return console.log(e)})},s.state={deployments:[],selectedDeployment:"",newDeploymentName:"",folderNameAlreadyExists:!1,validFolderName:!1},s.authBase64=null,s.props.userDetails&&s.props.userDetails.hasOwnProperty("username")&&null!==s.props.userDetails.username&&(s.authBase64=new e("".concat(s.props.userDetails.username,":").concat(s.props.userDetails.password)).toString("base64")),s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.getDeployments&&this.getDeploymentsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getDeployments()}},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"container"},c.a.createElement("div",{className:"deployments mt-20 mb-20"},c.a.createElement("h2",null,"Deployments"),c.a.createElement("p",null," Select a deployment folder to upload files to:"),c.a.createElement(d.a,{className:"deployments-list"},c.a.createElement(h.a,null,c.a.createElement(f.a,{xs:12,md:6,mdOffset:3},this.state.deployments.length?c.a.createElement(g.a,null,this.state.deployments.map(function(e,t){return c.a.createElement(b.a,{key:t},c.a.createElement("div",null,c.a.createElement(m.a,{to:"/deployments/".concat(e.name)},c.a.createElement("h3",{className:"display-inline"},e.name))))})):c.a.createElement("span",null,"No deployments were found.")))),c.a.createElement("div",{className:"mb-10"},c.a.createElement("p",null,"Or create a new deployment folder:"),c.a.createElement("input",{type:"text",dir:"auto",placeholder:"New folder name",value:this.state.newDeploymentName,className:"pt-input mb-10 ".concat(this.state.folderNameAlreadyExists&&"pt-intent-danger"),onChange:function(t){return e.newFolderNameValue(t)}}),this.state.folderNameAlreadyExists&&c.a.createElement("p",{className:"deployment-alert"},"There is already a deployment folder with this name."),this.state.newDeploymentName&&!this.state.validFolderName&&c.a.createElement("p",{className:"deployment-alert"},"Please don't use spaces or special characters on the folder name."),this.state.newDeploymentName&&!this.state.folderNameAlreadyExists&&this.state.validFolderName&&c.a.createElement("p",null,c.a.createElement(p.b,{className:"pt-button pt-intent-success",onClick:function(t){return e.createDeploymentFolder()}},"Create folder",c.a.createElement("span",{className:"pt-icon-standard pt-icon-arrow-right pt-align-right"}))))))}}]),a}(c.a.Component);y=Object(u.b)(function(e){return{userDetails:e.auth.userDetails}})(y)}).call(this,a(38).Buffer)},174:function(e,t,a){e.exports=a(272)},198:function(e,t,a){e.exports=a.p+"static/media/icon.f46e375d.png"},199:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return L});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(0),c=a.n(l),u=a(20),m=a(170),p=a(85),d=a.n(p),h=a(275),f=a(288),g=a(96),b=a(218),E=a(291),v=a(101),y=a(24),S=a(53),D=a(184),w=a(110),O=a(286),j=a(108),N=a(169),k=a(276),C=a(282),P=a(283),F=a(284),_=a(66),T=a(59),A=a(7),I=a(67),B=a(116),x=a(200),M=a(94),U={formatDate:function(e){return e.toISOString().split("T")[0]},parseDate:function(e){return new Date(e)},placeholder:"YYYY-MM-DD"},R=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).archiveForm=function(e){s.archiveFormPromise=Object(A.a)(Object(T.a)(s.props.formId,s.props.userDetails.username,s.props.userDetails.password)),s.archiveFormPromise.promise.then(function(e){s.setState({formArchivedOrDelete:!0})}).catch(function(e){return console.log(e)})},s.deleteForm=function(e){s.deleteFormPromise=Object(A.a)(Object(T.c)(s.props.formId,s.props.userDetails.username,s.props.userDetails.password)),s.deleteFormPromise.promise.then(function(e){s.setState({formArchivedOrDelete:!0})}).catch(function(e){return console.log(e)})},s.download=function(t,a){s.setState({downloadName:""});var n=new e(s.props.userDetails.username+":"+s.props.userDetails.password).toString("base64");return fetch("/omk/odk/submissions/".concat(t),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(n)}}).then(A.b).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e);s.setState({activeBlob:n}),s.setState({downloadName:a||t.split("?")[0]})})},s.downloadCsv=function(e){s.download("".concat(s.props.formId,".csv")),s.toggleDialog()},s.downloadJson=function(e){s.download("".concat(s.props.formId,".json")),s.toggleDialog()},s.downloadAttachments=function(e){s.download("".concat(s.props.formId,".zip")),s.toggleDialog()},s.downloadFilteredCsv=function(e){s.download("".concat(s.props.formId,".csv?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFilteredJson=function(e){s.download("".concat(s.props.formId,".json?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFilteredAttachments=function(e){s.download("".concat(s.props.formId,".zip?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadAllOsm=function(e){s.download("".concat(s.props.formId,".osm")),s.toggleDialog()},s.downloadFilteredOsm=function(e){s.download("".concat(s.props.formId,".osm?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadGeojson=function(e){s.download("".concat(s.props.formId,".geojson")),s.toggleDialog()},s.downloadFilteredGeojson=function(e){s.download("".concat(s.props.formId,".geojson?").concat(s.props.filterParams)),s.toggleDialog()},s.downloadFeaturesCsv=function(e){s.download("features/".concat(s.props.formId,".csv")),s.toggleDialog()},s.downloadFilteredFeaturesCsv=function(e){s.download("features/".concat(s.props.formId,".csv?").concat(s.props.filterParams)),s.toggleDialog()},s.toggleDialog=function(){return s.setState({openDialog:!s.state.openDialog})},s.state={activeBlob:"",downloadName:"",openDialog:!1,formArchivedOrDelete:!1},s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.archiveFormPromise&&this.archiveFormPromise.cancel(),this.deleteFormPromise&&this.deleteFormPromise.cancel()}},{key:"isAdmin",value:function(){return this.props.userDetails&&"admin"===this.props.userDetails.role}},{key:"renderDialog",value:function(){return c.a.createElement(h.a,{icon:"cloud-download",isOpen:this.state.openDialog,onClose:this.toggleDialog,title:"Download file"},c.a.createElement("div",{className:"pt-dialog-body"},this.state.downloadName?c.a.createElement("div",null,c.a.createElement("p",null,this.state.downloadName),c.a.createElement(f.a,{intent:g.a.PRIMARY,className:"pt-small",text:"Download",download:this.state.downloadName,href:this.state.activeBlob})):c.a.createElement("div",null,"Loading data, please wait...")))}},{key:"render",value:function(){var e=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",icon:"th",label:"Download CSV",onClick:this.downloadCsv}),c.a.createElement(E.a,{className:"pt-minimal",icon:"code",label:"Download JSON",onClick:this.downloadJson}),c.a.createElement(E.a,{className:"pt-minimal",icon:"compressed",label:"Download Attachments",onClick:this.downloadAttachments}),c.a.createElement(E.a,{className:"pt-minimal",icon:"th",label:"Download Filtered CSV",onClick:this.downloadFilteredCsv}),c.a.createElement(E.a,{className:"pt-minimal",icon:"code",label:"Download Filtered JSON",onClick:this.downloadFilteredJson}),c.a.createElement(E.a,{className:"pt-minimal",icon:"compressed",label:"Download Filtered Attachments",onClick:this.downloadFilteredAttachments})),t=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",label:"Data as OSM",onClick:this.downloadAllOsm}),c.a.createElement(E.a,{className:"pt-minimal",label:"Data as GeoJSON",onClick:this.downloadGeojson}),c.a.createElement(E.a,{className:"pt-minimal",label:"Data as CSV",onClick:this.downloadFeaturesCsv}),this.props.filterParams&&c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as OSM",onClick:this.downloadFilteredOsm}),c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as GeoJSON",onClick:this.downloadFilteredGeojson}),c.a.createElement(E.a,{className:"pt-minimal",label:"Filtered data as CSV",onClick:this.downloadFilteredFeaturesCsv}))),a=c.a.createElement(b.a,null,c.a.createElement(E.a,{className:"pt-minimal",icon:"add-to-folder",label:"Archive Form",onClick:this.archiveForm}),!this.props.hasSubmissions&&c.a.createElement(E.a,{className:"pt-minimal",icon:"trash",label:"Delete Form",onClick:this.deleteForm}));return c.a.createElement("div",null,this.state.formArchivedOrDelete?c.a.createElement(m.a,{to:"/"}):c.a.createElement("div",null,c.a.createElement(v.a,{content:e,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"link"},"ODK Data ",c.a.createElement(S.a,{icon:"caret-down"}))),c.a.createElement(v.a,{content:t,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"path-search"},"OSM Data ",c.a.createElement(S.a,{icon:"caret-down"}))),this.isAdmin()&&c.a.createElement(v.a,{content:a,position:y.a.BOTTOM,className:"pt-intent-default"},c.a.createElement(f.b,{icon:"cog"},"Manage ",c.a.createElement(S.a,{icon:"caret-down"}))),this.renderDialog()))}}]),a}(c.a.Component),z=function(t){function a(t){var s;return Object(n.a)(this,a),(s=Object(r.a)(this,Object(o.a)(a).call(this,t))).download=function(t,a){s.setState({downloadName:""});var n=new e(s.props.userDetails.username+":"+s.props.userDetails.password).toString("base64");return fetch("/omk/data/submissions/".concat(t),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(n)}}).then(A.b).then(function(e){return e.blob()}).then(function(e){var n=URL.createObjectURL(e);s.setState({activeBlob:n}),s.setState({downloadName:a||t.split("?")[0]})})},s.downloadFile=function(e){s.download(s.props.urlEnding,s.props.filename),s.toggleDialog()},s.toggleDialog=function(){return s.setState({openDialog:!s.state.openDialog})},s.state={activeBlob:"",openDialog:!1},s}return Object(i.a)(a,t),Object(s.a)(a,[{key:"renderDialog",value:function(){return c.a.createElement(h.a,{icon:"cloud-download",isOpen:this.state.openDialog,onClose:this.toggleDialog,title:"Download file"},c.a.createElement("div",{className:"pt-dialog-body"},this.state.downloadName?c.a.createElement("div",null,this.props.filename.endsWith(".jpg")||this.props.filename.endsWith(".png")?c.a.createElement(k.a,{src:this.state.activeBlob,responsive:!0,className:"preview-submission-img"}):c.a.createElement("p",null,this.props.filename),c.a.createElement(f.a,{intent:g.a.PRIMARY,className:"pt-small",text:"Download",download:this.props.filename,href:this.state.activeBlob})):c.a.createElement("div",null,"Loading data, please wait...")))}},{key:"render",value:function(){return this.props.filename?this.props.filename.endsWith(".osm")?c.a.createElement("div",null,c.a.createElement("a",{onClick:this.downloadFile},"OSM File"),this.renderDialog()):c.a.createElement("div",null,c.a.createElement("a",{onClick:this.downloadFile},"Download image"),this.renderDialog()):c.a.createElement("span",null,"No data")}}]),a}(c.a.Component),L=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).handleFilterStartDate=function(e){e?a.setState({startDate:e.toISOString().split("T")[0]}):a.setState({startDate:null})},a.handleFilterEndDate=function(e){e?a.setState({endDate:e.toISOString().split("T")[0]}):a.setState({endDate:null})},a.handleFilterDeviceIdChange=function(e){a.setState({filterDeviceId:e.target.value})},a.handleFilterUsernameChange=function(e){a.setState({filterUsername:e.target.value})},a.handlePageChange=function(e){a.setState({page:e.target.value})},a.handlePageSizeChange=function(e){a.setState({pageSize:e.target.value}),a.updatePagination(e.target.value,a.state.filteredSubmissions)},a.handleActivateMap=function(e){a.setState({activateMap:!a.state.activateMap}),a.state.pageSize>200&&a.setState({pageSize:200})},a.filterSubmissions=function(){a.setState({loading:!0}),a.updateFilterParams(),a.setState({page:1});var e=a.state.submissions;a.state.startDate&&(e=e.filter(function(e){return d()(a.state.startDate).isBefore(e[3],"day")||d()(a.state.startDate).isSame(e[3],"day")})),a.state.endDate&&(e=e.filter(function(e){return d()(a.state.endDate).isAfter(e[3],"day")||d()(a.state.endDate).isSame(e[3],"day")})),a.state.filterDeviceId&&(e=e.filter(function(e){return e[2]&&e[2].toString().includes(a.state.filterDeviceId)})),a.state.filterUsername&&(e=e.filter(function(e){return e[2]&&e[2].toString().includes(a.state.filterUsername)})),a.setState({filteredSubmissions:e}),a.updatePagination(a.state.pageSize,e),a.setState({loading:!1})},a.clearFilter=function(){a.setState({loading:!0}),a.setState({filteredSubmissions:a.state.submissions}),a.setState({filterStartDate:null}),a.setState({filterEndDate:null}),a.setState({filterDeviceId:""}),a.setState({filterUsername:""}),a.updatePagination(a.state.pageSize,a.state.submissions),a.setState({loading:!1}),a.setState({filterParams:"offset=".concat((a.state.page-1)*a.state.pageSize||0,"&limit=").concat(a.state.pageSize)})},a.getFormDetails=function(){a.getFormDetailsPromise=Object(A.a)(Object(I.a)(a.props.formId)),a.getFormDetailsPromise.promise.then(function(e){a.setState({formName:e.xforms.xform[0].name}),a.setState({totalSubmissions:e.xforms.xform[0].totalSubmissions})}).catch(function(e){return console.log(e)})},a.getAuthStatus=function(){a.getAuthStatusPromise=Object(A.a)(Object(B.a)()),a.getAuthStatusPromise.promise.then(function(e){console.log("response "+e.auth_enabled),a.setState({authEnabled:e.auth_enabled})}).catch(function(e){return console.log(e)})},a.getSubmissions=function(){a.getSubmissionsPromise=Object(A.a)(Object(_.a)(a.props.formId,a.props.userDetails.username,a.props.userDetails.password)),a.getSubmissionsPromise.promise.then(function(e){var t=e.map(function(e){return[e.start,e.end?e.end:e.meta.submissionTime,e.username?e.username:e.deviceid,e.meta.submissionTime,e.image,Object.values(e).filter(function(e){return"string"===typeof e&&e.endsWith(".osm")})[0],e.meta.instanceId.split(":")[1]]});e.length>0&&e[0].hasOwnProperty("username")&&a.setState({hasUsername:!0}),a.setState({submissions:t}),a.setState({filteredSubmissions:t}),a.setState({loading:!1}),a.updatePagination(a.state.pageSize,t)}).catch(function(e){console.log(e),a.setState({loading:!1})})},a.renderCell=function(e,t){return c.a.createElement(w.a,null,a.getPageSlice()[e][t])},a.renderDateCell=function(e,t){return c.a.createElement(w.a,null,d()(a.getPageSlice()[e][t]).format("lll"))},a.renderCellImage=function(e,t){return c.a.createElement(w.a,null,a.getPageSlice()[e][t]?c.a.createElement(z,{urlEnding:"".concat(a.props.formId,"/").concat(a.getPageSlice()[e][t+2],"/").concat(a.getPageSlice()[e][t]),filename:a.getPageSlice()[e][t],userDetails:a.props.userDetails}):c.a.createElement("span",null,"No image"))},a.renderCellLink=function(e,t){return c.a.createElement(w.a,null,c.a.createElement(z,{urlEnding:"".concat(a.props.formId,"/").concat(a.getPageSlice()[e][t+1],"/").concat(a.getPageSlice()[e][t]),filename:a.getPageSlice()[e][t],userDetails:a.props.userDetails}))},a.state={submissions:[],filteredSubmissions:[],slicedSubmissions:[],loading:!0,formName:"",totalSubmissions:0,startDate:null,endDate:null,filterDeviceId:"",filterUsername:"",filterParams:"offset=0&limit=200",hasUsername:!1,page:1,pageSize:200,pageCount:1,activateMap:!1,authEnabled:!0},a}return Object(i.a)(t,e),Object(s.a)(t,[{key:"componentWillUnmount",value:function(){this.getSubmissionsPromise&&this.getSubmissionsPromise.cancel(),this.getFormDetailsPromise&&this.getFormDetailsPromise.cancel(),this.getAuthStatusPromise&&this.getAuthStatusPromise.cancel()}},{key:"componentDidMount",value:function(){this.getSubmissions(),this.getFormDetails(),this.props.userDetails&&null!=this.props.userDetails.username||this.getAuthStatus()}},{key:"componentDidUpdate",value:function(e,t){this.props.userDetails.username!==e.userDetails.username&&this.getSubmissions(),t.page===this.state.page&&t.pageSize===this.state.pageSize||this.updateFilterParams()}},{key:"updatePagination",value:function(e,t){if(t.length>e){var a=t.length%e;this.setState({pageCount:(t.length-a)/e+1})}else this.setState({pageCount:1})}},{key:"updateFilterParams",value:function(){var e={deviceId:this.state.filterDeviceId,start_date:this.state.startDate,end_date:this.state.endDate,username:this.state.filterUsername,offset:(this.state.page-1)*this.state.pageSize||0,limit:this.state.pageSize||200},t=Object.keys(e).filter(function(t){return e[t]}).reduce(function(t,a){return"".concat(t).concat(a,"=").concat(e[a],"&")},"");this.setState({filterParams:t})}},{key:"getPageSlice",value:function(){return this.state.filteredSubmissions.slice((this.state.page-1)*this.state.pageSize,this.state.page*this.state.pageSize)}},{key:"renderFilterSection",value:function(){var e=this.state.submissions.map(function(e){return e[2]});return e=e.filter(function(e){return void 0!==e}).filter(function(t,a){return e.indexOf(t)===a}),c.a.createElement(C.a,{className:"filters ml-0 mr-0"},c.a.createElement(C.a,{className:"ml-0 mr-0"},c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"start-date",className:"display-block"},"From",c.a.createElement(D.a,{content:"Based on the Submission Date",position:y.a.RIGHT},c.a.createElement(S.a,{icon:"help",color:"#CED9E0",className:"help-icon"}))),c.a.createElement(N.a,Object.assign({},U,{id:"start-date",onChange:this.handleFilterStartDate}))),c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"end-date",className:"display-block"},"To",c.a.createElement(D.a,{content:"Based on the Submission Date",position:y.a.RIGHT},c.a.createElement(S.a,{icon:"help",color:"#CED9E0",className:"help-icon"}))),c.a.createElement(N.a,Object.assign({},U,{id:"end-date",onChange:this.handleFilterEndDate})))),c.a.createElement(C.a,{className:"ml-0 mr-0"},this.state.hasUsername?c.a.createElement(P.a,{xs:12,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"filter-username",className:"display-block"},"Username"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handleFilterUsernameChange,value:this.state.filterUsername},c.a.createElement("option",{value:null},"Choose an item..."),e.map(function(e,t){return c.a.createElement("option",{key:t,value:"".concat(e)},e.toString())})))):c.a.createElement(P.a,{xs:12,className:"pt-input-group"},c.a.createElement("label",{htmlFor:"filter-deviceid",className:"display-block"},"Device ID"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handleFilterDeviceIdChange,value:this.state.filterDeviceId},c.a.createElement("option",{value:null},"Choose an item..."),e.map(function(e,t){return c.a.createElement("option",{key:t,value:"".concat(e)},e.toString())}))))),c.a.createElement(C.a,{className:"ml-0 mr-0"},c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement(f.b,{className:"pt-intent-success filter-btn",icon:"filter",text:"Filter",onClick:this.filterSubmissions})),c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement(f.b,{className:"pt-intent-danger filter-btn",icon:"filter-remove",text:"Clear",onClick:this.clearFilter}))))}},{key:"renderTable",value:function(){return this.state.loading?c.a.createElement("div",{id:"loading-msg"},"Loading data, please wait..."):0===this.state.filteredSubmissions.length?c.a.createElement("div",{id:"loading-msg"},"No data was found."):c.a.createElement(O.a,{className:"submissions-table center-block",columnWidths:[170,170,170,170,140,140],numRows:this.getPageSlice().length},c.a.createElement(j.a,{name:"Start",cellRenderer:this.renderDateCell}),c.a.createElement(j.a,{name:"End",cellRenderer:this.renderDateCell}),this.state.hasUsername?c.a.createElement(j.a,{name:"Username",cellRenderer:this.renderCell}):c.a.createElement(j.a,{name:"Device ID",cellRenderer:this.renderCell}),c.a.createElement(j.a,{name:"Submission Time",cellRenderer:this.renderDateCell}),c.a.createElement(j.a,{name:"Image",cellRenderer:this.renderCellImage}),c.a.createElement(j.a,{name:"Download",cellRenderer:this.renderCellLink}))}},{key:"renderMapSwitchButton",value:function(){var e=this;return c.a.createElement(C.a,{className:"ml-0 mr-0"},c.a.createElement(P.a,{xs:12},this.state.activateMap?c.a.createElement(f.b,{className:"pt-intent",icon:"th",text:"Switch to Table view",onClick:function(){return e.setState({activateMap:!1})}}):c.a.createElement(f.b,{className:"pt-intent",icon:"map",text:"Switch to Map view",onClick:function(){return e.setState({activateMap:!0})}})))}},{key:"renderPagination",value:function(){return c.a.createElement(C.a,{className:"pagination pt-input-group ml-0 mr-0"},c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{className:"display-block"},"Page Size"),c.a.createElement("div",{className:"pt-select"},this.state.activateMap?c.a.createElement("select",{onChange:this.handlePageSizeChange,value:this.state.pageSize},[1e3,800,600,400,200,100,50,20].map(function(e,t){return c.a.createElement("option",{key:t,value:e},e.toString())})):c.a.createElement("select",{onChange:this.handlePageSizeChange},[200,100,50,20].map(function(e,t){return c.a.createElement("option",{key:t,value:e},e.toString())})))),c.a.createElement(P.a,{xs:12,md:6,className:"pt-input-group"},c.a.createElement("label",{className:"display-block"},"Page"),c.a.createElement("div",{className:"pt-select"},c.a.createElement("select",{onChange:this.handlePageChange},Array.apply(null,{length:this.state.pageCount}).map(Number.call,Number).map(function(e){return e+1}).map(function(e,t){return c.a.createElement("option",{key:t,value:e},e.toString())})))))}},{key:"render",value:function(){var e=this.props.userDetails&&null!=this.props.userDetails.username||!this.state.authEnabled;return c.a.createElement("div",null,e?c.a.createElement(F.a,{fluid:!0,className:"pl-0 pr-0"},c.a.createElement(C.a,{className:"ml-0 mr-0"},c.a.createElement(P.a,{xs:12,md:3},c.a.createElement("div",{className:"submissions-info"},c.a.createElement("h4",{className:"break-all"},this.state.formName),c.a.createElement("p",null,"Total submissions: ",this.state.totalSubmissions),c.a.createElement(R,{formId:this.props.formId,hasSubmissions:this.state.totalSubmissions>0,filterParams:this.state.filterParams,userDetails:this.props.userDetails})),this.renderFilterSection(),this.renderPagination(),this.renderMapSwitchButton()),c.a.createElement(P.a,{xs:12,md:9,className:"ml-0 mr-0 pr-0"},this.state.activateMap?c.a.createElement(x.a,{userDetails:this.props.userDetails,formId:this.props.formId,filterParams:this.state.filterParams,hasUsername:this.state.hasUsername}):this.renderTable()))):c.a.createElement(M.a,null))}}]),t}(c.a.Component);L=Object(u.b)(function(e,t){return{userDetails:e.auth.userDetails,formId:t.match.params.formId}})(L)}).call(this,a(38).Buffer)},200:function(e,t,a){"use strict";a.d(t,"a",function(){return S});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(0),c=a.n(l),u=a(185),m=a.n(u),p=a(55),d=a(201),h=a(202),f=a(274),g=a(60),b=a(53),E=a(66),v=["#29A634","#1F4B99","#D99E0B","#D13913","#8F398F","#00B3A4","#728C23","#DB2C6F","#B07B46","#7157D9","#B6D94C","#63411E"];function y(e,t){return e.sort(function(e,a){var n=e[t],s=a[t];return n>s?-1:n<s?1:0})}var S=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).map=null,a.state={info_content:"",display_map_info:"none",data:{},showVizTypeSwitch:!1,vizType:"default",legend:[],showLegend:!0},a}return Object(i.a)(t,e),Object(s.a)(t,[{key:"get_paint_property",value:function(e){return"default"===this.state.vizType?"#4580E6":"date"===this.state.vizType?this.get_color_steps_by_date(e):"user"===this.state.vizType?this.get_color_steps_by_user(e):void 0}},{key:"get_color_steps_by_date",value:function(e){var t=[],a=y(Object(h.array)(e.features.map(function(e){return new Date(e.properties.submission_date)})).filter(function(e){return e.count}),"count"),n=["match",["get","submission_date"]];return a.slice(0,12).map(function(e,a){n=n.concat([e.day,v[a]]),t.push([e.day,v[a]])}),n.push("#4580E6"),t.push(["Others","#4580E6"]),this.setState({legend:t}),n}},{key:"get_color_steps_by_user",value:function(e){var t,a,n=[];this.props.hasUsername?(t=e.features.map(function(e){return e.properties.submission_user}),a="submission_user"):(t=e.features.map(function(e){return e.properties.submission_deviceid}),a="submission_deviceid");var s=new p.Set(t),r=[];s.map(function(e){return r.push({user:e,count:t.filter(function(t){return t===e}).length})}),r=y(r,"count");var o=["match",["get",a]];return r.slice(0,12).map(function(e,t){o=o.concat([e.user,v[t]]),n.push([e.user,v[t]])}),o.push("#4580E6"),n.push(["Others","#4580E6"]),this.setState({legend:n}),o}},{key:"add_data_to_map",value:function(){var e=this;this.map.getSource("submissions")&&(["submission_areas","submission_lines","submission_points"].map(function(t){return e.map.removeLayer(t)}),this.map.removeSource("submissions")),Object(E.b)(this.props.formId,this.props.userDetails.username,this.props.userDetails.password,this.props.filterParams).then(function(t){e.setState({showVizTypeSwitch:!0}),t.features=t.features.filter(function(e){return Object.keys(e.properties).length>7}),e.setState({data:t});var a=e.get_paint_property(t);e.map.addSource("submissions",{type:"geojson",data:t}),e.map.addLayer({id:"submission_lines",type:"line",source:"submissions",filter:["==","$type","LineString"],paint:{"line-color":a,"line-width":3}}),e.map.addLayer({id:"submission_areas",type:"fill",source:"submissions",filter:["in","$type","Polygon"],paint:{"fill-color":a,"fill-opacity":.4,"fill-outline-color":"#61FC03"}}),e.map.addLayer({id:"submission_points",type:"circle",source:"submissions",filter:["==","$type","Point"],paint:{"circle-color":a,"circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),e.map.fitBounds(Object(d.extent)(t),{padding:{top:80,bottom:35,left:35,right:35},linear:!0})})}},{key:"componentDidUpdate",value:function(e,t){if(this.props.filterParams!==e.filterParams&&this.add_data_to_map(),this.state.vizType!==t.vizType){var a=this.get_paint_property(this.state.data);this.map.setPaintProperty("submission_lines","line-color",a),this.map.setPaintProperty("submission_areas","fill-color",a),this.map.setPaintProperty("submission_points","circle-color",a)}}},{key:"componentDidMount",value:function(){var e=this;m.a.accessToken="pk.eyJ1IjoiaG90IiwiYSI6IlBtUmNiR1kifQ.dCS1Eu9DIRNZGktc24IwtA",this.map=new m.a.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9"}),this.map.addControl(new m.a.NavigationControl,"top-right"),this.map.on("load",function(){e.add_data_to_map()}),this.map.on("click",function(t){var a=[t.point.x-5,t.point.y-5],n=[t.point.x+5,t.point.y+5],s=e.map.queryRenderedFeatures([a,n],{layers:["submission_areas","submission_lines","submission_points"]});if(s.length){var r=function(e){var t={};return Object.keys(e).sort().forEach(function(a){t[a]=e[a]}),t}(s[0].properties),o=Object.keys(r),i=Object.values(r);e.setState({info_content:o.map(function(e,t){return c.a.createElement("tr",{key:t},c.a.createElement("td",{className:"feature-key"},e),c.a.createElement("td",{className:"feature-value"},i[t]))})}),e.setState({display_map_info:"block"})}else e.setState({display_map_info:"none",info_content:""})}),["submission_areas","submission_lines","submission_points"].forEach(function(t){e.map.on("mouseenter",t,function(){e.map.getCanvas().style.cursor="pointer"}),e.map.on("mouseleave",t,function(){e.map.getCanvas().style.cursor=""})})}},{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement("div",{id:"map"},c.a.createElement("div",{className:"map-info ".concat(this.state.info_content&&"display-block")},c.a.createElement("table",null,c.a.createElement("tbody",null,this.state.info_content))),this.state.showVizTypeSwitch&&c.a.createElement("div",{className:"color-switch"},c.a.createElement(f.a,{label:"Features colouring",onChange:function(t){return e.setState({vizType:t.target.value})},selectedValue:this.state.vizType},c.a.createElement(g.a,{label:"Default Color",value:"default"}),c.a.createElement(g.a,{label:"By Submission Date",value:"date"}),c.a.createElement(g.a,{label:"By ".concat(this.props.hasUsername?"User":"Device ID"),value:"user"})),"default"!==this.state.vizType&&c.a.createElement("div",null,c.a.createElement("label",{id:"legend-label",class:"pt-label",onClick:function(t){return e.setState({showLegend:!e.state.showLegend})}},this.state.showLegend?c.a.createElement(b.a,{icon:"chevron-down"}):c.a.createElement(b.a,{icon:"chevron-right"}),"Legend"),this.state.showLegend&&this.state.legend.map(function(e,t){return c.a.createElement("div",{key:t},c.a.createElement(b.a,{icon:"full-circle",color:"".concat(e[1])})," ",c.a.createElement("span",null,e[0]))})))))}}]),t}(c.a.Component)},216:function(e,t,a){},25:function(e,t,a){"use strict";function n(e){try{return localStorage.getItem(e)||null}catch(t){return console.warn("Could not read from localStorage."),null}}function s(e,t){try{localStorage.setItem(e,t)}catch(a){console.warn("Could not write to localStorage.")}}function r(e){try{localStorage.removeItem(e)}catch(t){console.warn("Could not delete from localStorage.")}}a.d(t,"a",function(){return n}),a.d(t,"c",function(){return s}),a.d(t,"b",function(){return r})},268:function(e,t,a){},272:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(18),o=a.n(r),i=a(289),l=a(20),c=a(197),u=a.n(c),m=(a(204),a(206),a(208),a(210),a(212),a(214),a(216),a(13)),p=a(14),d=a(9),h=a(15),f=a(16),g=a(287),b=a(273),E=a(218),v=a(291),y=a(101),S=a(24),D=a(288),w=a(292),O=a(83),j=a(84),N=a(54),k=a(116),C=a(7),P=a(198),F=a.n(P),_=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).getAuthStatus=function(){a.getAuthStatusPromise=Object(C.a)(Object(k.a)()),a.getAuthStatusPromise.promise.then(function(e){a.setState({authEnabled:e.auth_enabled})}).catch(function(e){return console.log(e)})},a.state={authEnabled:!0},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.userDetails&&null!=this.props.userDetails.username||this.getAuthStatus()}},{key:"isAuthenticated",value:function(){return this.props.userDetails&&null!=this.props.userDetails.username}},{key:"isAdmin",value:function(){return this.props.userDetails&&"admin"===this.props.userDetails.role||!this.state.authEnabled}},{key:"renderAuthSubMenu",value:function(){if(this.state.authEnabled){if(this.isAuthenticated()){var e=s.a.createElement(E.a,null,s.a.createElement(v.a,{className:"pt-minimal",icon:"log-out",label:"Logout",onClick:this.props.doLogout}));return s.a.createElement(y.a,{content:e,position:S.a.BOTTOM,className:"pt-intent-default"},s.a.createElement(D.b,{icon:"user",text:this.props.userDetails.username}))}return s.a.createElement(b.a,{to:"/login"},s.a.createElement(D.b,{className:"pt-minimal",icon:"user"},"Log in"))}}},{key:"render",value:function(){return s.a.createElement(w.a,{className:"default-green-bg pt-dark"},s.a.createElement(O.a,null,s.a.createElement("img",{className:"pt-icon main-logo pt-align-left",src:F.a,alt:"omk logo"}),s.a.createElement(j.a,null,s.a.createElement(b.a,{to:"/"},s.a.createElement("h3",null,"OpenMapKit Server")))),s.a.createElement(O.a,{align:"right"},s.a.createElement(b.a,{to:"/"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"home"},"Home")),this.isAdmin()&&s.a.createElement(b.a,{to:"/deployments"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"cloud-upload"},"Deployments")),this.isAdmin()&&s.a.createElement(b.a,{to:"/upload-form"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"cloud-upload"},"Upload Form")),this.isAdmin()&&s.a.createElement(b.a,{to:"/archived-forms"},s.a.createElement(D.b,{className:"pt-minimal pt-white",icon:"folder-close"},"Archived Forms")),this.renderAuthSubMenu()))}}]),t}(s.a.Component);_=Object(l.b)(function(e){return{userDetails:e.auth.userDetails}},function(e){return{doLogout:function(){return e(Object(N.b)())}}})(_);var T=a(199),A=a(94),I=a(168),B=a(55),x=a(183),M=a(285),U=a(283),R=a(284),z=a(282),L=a(67),W=a(139),X=a.n(W);var q=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"renderCol",value:function(e){return s.a.createElement(x.a,{interactive:!0,elevation:x.b.TWO},s.a.createElement("h5",{className:"card-title"},e.get("name")),s.a.createElement("div",{className:"text-left form-info"},s.a.createElement("p",null,"Number of Submissions: ",e.get("totalSubmissions")),s.a.createElement("p",null,"Form ID: ",s.a.createElement("code",null,e.get("formID"))),s.a.createElement(M.a,{fill:!0,vertical:!0,large:!1},s.a.createElement(b.a,{to:"/submissions/".concat(e.get("formID"))},s.a.createElement(D.b,{icon:"list"},"View submissions")),s.a.createElement(D.a,{icon:"th",download:!0,href:"/omk/data/forms/".concat(e.get("formID"),".xlsx")},"XSLX Form"),s.a.createElement(D.a,{icon:"code",download:!0,href:"/omk/data/forms/".concat(e.get("formID"),".xml")},"XForm XML"))))}},{key:"renderRow",value:function(e,t){var a=this;return e.slice(4*t,4*(t+1)).map(function(e,t){return s.a.createElement(U.a,{key:t,md:3,xs:12,className:"forms-col"},a.renderCol(e))})}},{key:"render",value:function(){var e=this,t=[],a=0;try{a=(t=this.props.data.get("data").get("xforms").get("xform")).size}catch(r){TypeError}var n=Math.floor(a/4);return s.a.createElement(R.a,{className:"forms-grid"},Object(I.a)(Array(n+1).keys()).map(function(a){return s.a.createElement(z.a,{key:a,className:"forms-row"},e.renderRow(t,a))}))}}]),t}(s.a.Component);q=function(e,t,a){var n,r;return r=n=function(n){function r(t){var a;return Object(m.a)(this,r),(a=Object(d.a)(this,Object(h.a)(r).call(this,t))).state={data:Object(B.Map)()},a._initFetching=function(t){a.fetchedData=e(t),Object.keys(a.fetchedData).forEach(function(e){a.fetchedData[e].promise.then(function(t){var n=a.state.data;n=n.set(e,Object(B.fromJS)(t)),a.setState({data:n})}).catch(function(e){return console.error(e)})})},a.reloadData=function(){a.initFetching(a.props)},a.initFetching=X()(a._initFetching,500),a}return Object(f.a)(r,n),Object(p.a)(r,[{key:"componentDidMount",value:function(){this.initFetching(this.props)}},{key:"componentWillReceiveProps",value:function(e){t(e,this.props)&&this.initFetching(e)}},{key:"componentWillUnmount",value:function(){var e=this;this.fetchedData&&Object.keys(this.fetchedData).forEach(function(t){e.fetchedData[t]&&e.fetchedData[t].cancel()})}},{key:"render",value:function(){return s.a.createElement(a,Object.assign({},this.props,{data:this.state.data,reloadData:this.reloadData}))}}]),r}(s.a.PureComponent),n.displayName="HOCFetchData".concat(function(e){return e.displayName||e.name||"Component"}(a)),r}(function(e){return{data:Object(C.a)(Object(L.a)())}},function(e,t){return!0},q);var G=a(140),J=a(164),H=a(290),V=a(59),Y=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={visible:!0},a.restoreForm=function(e){a.restoreFormPromise=Object(C.a)(Object(V.d)(a.props.formName,a.props.userDetails.username,a.props.userDetails.password)),a.restoreFormPromise.promise.then(function(e){a.setState({visible:!1})}).catch(function(e){return console.log(e)})},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.restoreFormPromise&&this.restoreFormPromise.cancel()}},{key:"render",value:function(){return s.a.createElement(J.a,null,this.state.visible?s.a.createElement("div",null,s.a.createElement("h3",{className:"display-inline"},this.props.formName),s.a.createElement(D.b,{className:"display-inline restore-btn",icon:"refresh",intent:"warning",text:"Restore",onClick:this.restoreForm})):s.a.createElement("div",null,s.a.createElement("h3",null,"Form Restored")))}}]),t}(s.a.Component),K=function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={forms:[]},a.getArchivedForms=function(){a.getArchivedFormsPromise=Object(C.a)(Object(V.b)(a.props.userDetails.username,a.props.userDetails.password)),a.getArchivedFormsPromise.promise.then(function(e){return a.setState({forms:e.forms})}).catch(function(e){return console.log(e)})},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentWillUnmount",value:function(){this.getArchivedFormsPromise&&this.getArchivedFormsPromise.cancel()}},{key:"componentDidMount",value:function(){this.getArchivedForms()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"archived-forms"},s.a.createElement("h2",null,"Archived Forms"),s.a.createElement(R.a,{className:"archived-form-list"},s.a.createElement(z.a,null,s.a.createElement(U.a,{xs:12,md:6,mdOffset:3},this.state.forms.length?s.a.createElement(H.a,null,this.state.forms.map(function(t,a){return s.a.createElement(Y,{key:a,userDetails:e.props.userDetails,formName:t})})):s.a.createElement("span",null,"No archived forms were found.")))))}}]),t}(s.a.Component);K=Object(l.b)(function(e,t){return{userDetails:e.auth.userDetails}})(K);var $=a(143),Q=a(165),Z=(a(268),function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(_,null),s.a.createElement(g.a,{exact:!0,path:"/",component:q}),s.a.createElement(g.a,{exact:!0,path:"/login",component:A.a}),s.a.createElement(g.a,{exact:!0,path:"/upload-form",component:G.a}),s.a.createElement(g.a,{exact:!0,path:"/archived-forms",component:K}),s.a.createElement(g.a,{exact:!0,path:"/deployments",component:Q.a}),s.a.createElement(g.a,{exact:!0,path:"/deployments/:deployment",component:$.a}),s.a.createElement(g.a,{exact:!0,path:"/submissions/:formId",component:T.a}))}}]),t}(n.Component)),ee=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function te(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var ae=a(36),ne=a(166),se=a.n(ne),re=a(117),oe=a(167),ie=a(25),le={userDetails:new Map};var ce=Object(ae.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N.c.SET_USER:return{userDetails:t.userDetails};default:return e}},router:re.routerReducer}),ue={auth:{userDetails:{id:ie.a("username"),username:ie.a("username"),password:ie.a("password"),role:ie.a("role")}}},me=se()(),pe=[oe.a,Object(re.routerMiddleware)(me)],de=ae.d.apply(void 0,[ae.a.apply(void 0,pe)].concat([])),he=Object(ae.e)(ce,ue,de),fe=u()();o.a.render(s.a.createElement(l.a,{store:he},s.a.createElement(i.a,{history:fe},s.a.createElement(Z,null))),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/omk/pages",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/omk/pages","/service-worker.js");ee?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):te(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):te(e)})}}()},54:function(e,t,a){"use strict";a.d(t,"c",function(){return s}),a.d(t,"b",function(){return r}),a.d(t,"a",function(){return o});var n=a(25),s={SET_USER:"SET_USER",CLEAR_USER:"CLEAR_USER"};var r=function(){return function(e){n.b("id"),n.b("username"),n.b("password"),n.b("role"),e({type:s.SET_USER,userDetails:{}})}},o=function(e,t){return function(a){fetch("/omk/login/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then(function(e){return e.json()}).then(function(e){n.c("id",e.user.id),n.c("username",e.user.username),n.c("password",e.user.password),n.c("role",e.user.role),a(function(e){return{type:s.SET_USER,userDetails:e}}(e.user))}).catch(function(e){return console.warn(e)})}}},59:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return s}),a.d(t,"d",function(){return r}),a.d(t,"a",function(){return o}),a.d(t,"c",function(){return i});var n=a(7);function s(t,a){var s=new e(t+":"+a).toString("base64");return fetch("/omk/odk/archived-forms",{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(s)}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/restore");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function o(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/archive");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function i(t,a,s){var r=new e(a+":"+s).toString("base64"),o="/omk/odk/forms/".concat(t,"/delete");return fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}}).call(this,a(38).Buffer)},66:function(e,t,a){"use strict";(function(e){a.d(t,"a",function(){return s}),a.d(t,"b",function(){return r});var n=a(7);function s(t,a,s){var r=new e(a+":"+s).toString("base64");return fetch("/omk/odk/submissions/".concat(t,".json?offset=0&limit=5000"),{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(r)}}).then(n.b).then(function(e){return e.json()})}function r(t,a,s,r){var o=new e(a+":"+s).toString("base64"),i="/omk/odk/submissions/".concat(t,".geojson?").concat(r);return fetch(i,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Authorization:"Basic ".concat(o)}}).then(n.b).then(function(e){return e.json()})}}).call(this,a(38).Buffer)},67:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(7);function s(e){var t="/formList?json=true";return e&&(t="/formList?json=true&formid=".concat(e)),fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(n.b).then(function(e){return e.json()})}},7:function(e,t,a){"use strict";function n(e){var t=!1;return{promise:new Promise(function(a,n){e.then(function(e){return t?n({isCanceled:!0}):a(e)}).catch(function(e){return n(t?{isCanceled:!0}:e)})}),cancel:function(){t=!0}}}function s(e){if(!e.ok)throw Error(e.statusText);return e}a.d(t,"a",function(){return n}),a.d(t,"b",function(){return s})},94:function(e,t,a){"use strict";a.d(t,"a",function(){return f});var n=a(13),s=a(14),r=a(9),o=a(15),i=a(16),l=a(33),c=a(0),u=a.n(c),m=a(20),p=a(170),d=a(288),h=a(54),f=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(r.a)(this,Object(o.a)(t).call(this,e))).onSubmit=function(e){e.preventDefault(),a.props.authenticateUser(a.state.username,a.state.password),a.setState({triedToLogin:!0})},a.state={username:e.username?e.username:"",password:"",triedToLogin:!1},a.onSubmit=a.onSubmit.bind(Object(l.a)(Object(l.a)(a))),a.changeUsername=a.changeUsername.bind(Object(l.a)(Object(l.a)(a))),a.changePassword=a.changePassword.bind(Object(l.a)(Object(l.a)(a))),a}return Object(i.a)(t,e),Object(s.a)(t,[{key:"changeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"changePassword",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){return u.a.createElement("div",{className:"pt-input-group login center-block"},this.props.username?u.a.createElement(p.a,{to:"/"}):u.a.createElement("div",null,u.a.createElement("form",{onSubmit:this.onSubmit},u.a.createElement("h2",null,"Sign in"),this.state.triedToLogin&&u.a.createElement("div",{class:"pt-callout pt-intent-danger"},u.a.createElement("h4",{class:"pt-callout-title"},"Login failed"),"Verify your username or password."),u.a.createElement("input",{type:"text",className:"pt-input mt-10",value:this.state.username,onChange:this.changeUsername,placeholder:"Username"}),u.a.createElement("input",{type:"password",className:"pt-input mt-10",value:this.state.password,onChange:this.changePassword,placeholder:"Enter your password..."}),u.a.createElement(d.b,{type:"submit",className:"pt-large",intent:"success",icon:"log-in",text:"Sign In"}))))}}]),t}(u.a.Component);f=Object(m.b)(function(e){return{username:e.auth.userDetails?e.auth.userDetails.username:""}},function(e){return{authenticateUser:function(t,a){return e(Object(h.a)(t,a))}}})(f)}},[[174,2,1]]]);
//# sourceMappingURL=main.9ceb1176.chunk.js.map